(function e$jscomp$0(n,k,a){function g(d,f){if(!k[d]){if(!n[d]){var m="function"==typeof require&&require;if(!f&&m)return m(d,!0);if(h)return h(d,!0);m=Error("Cannot find module '"+d+"'");throw m.code="MODULE_NOT_FOUND",m;}m=k[d]={exports:{}};n[d][0].call(m.exports,function(a){var e=n[d][1][a];return g(e?e:a)},m,m.exports,e$jscomp$0,n,k,a)}return k[d].exports}for(var h="function"==typeof require&&require,m=0;m<a.length;m++)g(a[m]);return g})({1:[function(l,n,k){(function(a){var g=a.Twilio||function(){};
Object.assign(g,l("./twilio"));a.Twilio=g})("undefined"!==typeof window?window:global)},{"./twilio":2}],2:[function(l,n,k){k.Device=l("./twilio/device").Device;k.PStream=l("./twilio/pstream").PStream;k.Connection=l("./twilio/connection").Connection},{"./twilio/connection":4,"./twilio/device":5,"./twilio/pstream":11}],3:[function(l,n,k){function a(c,e,f){if(!(this instanceof a))return new a(c,e,f);q.call(this);f=f||{};var d=new Map,v=new Map,t="undefined"!==typeof AudioContext,w="undefined"!==typeof navigator&&
"undefined"!==typeof navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.enumerateDevices,u="undefined"!==typeof HTMLAudioElement&&"function"===typeof HTMLAudioElement.prototype.setSinkId,y=w&&u,F=w&&t;f.soundOptions&&h(this,f.soundOptions);u=t=null;F&&(t=new AudioContext,u=t.createAnalyser(),u.fftSize=32,u.smoothingTimeConstant=.3);var B=this;Object.defineProperties(this,{_audioContext:{value:t},_getUserMedia:{value:f.getUserMedia||p},_inputDevice:{value:null,writable:!0},_inputStream:{value:null,
writable:!0},_inputVolumeAnalyser:{value:u},_isPollingInputVolume:{value:!1,writable:!0},_onActiveInputChanged:{value:e},_mediaDevices:{value:f.mediaDevices||b},_unknownDeviceIndexes:{value:{}},_updateAvailableDevices:{value:m.bind(null,this)},availableInputDevices:{enumerable:!0,value:v},availableOutputDevices:{enumerable:!0,value:d},inputDevice:{enumerable:!0,get:function(){return B._inputDevice}},inputStream:{enumerable:!0,get:function(){return B._inputStream}},isVolumeSupported:{enumerable:!0,
value:F},isOutputSelectionSupported:{enumerable:!0,value:y},ringtoneDevices:{enumerable:!0,value:new r("ringtone",d,c,y)},speakerDevices:{enumerable:!0,value:new r("speaker",d,c,y)}});this.on("newListener",function(b){"inputVolume"===b&&B._maybeStartPollingVolume()});this.on("removeListener",function(b){"inputVolume"===b&&B._maybeStopPollingVolume()});this.once("newListener",function(){y||console.warn("Warning: This browser does not support audio output selection.");F||console.warn("Warning: This browser does not support Twilio's volume indicator feature.")});
w&&g(this)}function g(b){b._mediaDevices.addEventListener("devicechange",b._updateAvailableDevices);b._mediaDevices.addEventListener("deviceinfochange",b._updateAvailableDevices);m(b).then(function(){b.isOutputSelectionSupported&&(b.speakerDevices.set("default"),b.ringtoneDevices.set("default"))})}function h(b,c){function a(b,c){"undefined"!==typeof c&&(r[b]=c);return r[b]}var r=c.__dict__;r&&Object.keys(r).forEach(function(c){b[c]=a.bind(null,c)})}function m(b){return b._mediaDevices.enumerateDevices().then(function(c){e(b,
w(c,"audiooutput"),b.availableOutputDevices,d);e(b,w(c,"audioinput"),b.availableInputDevices,f)})}function d(b,c){return b.speakerDevices._delete(c)|b.ringtoneDevices._delete(c)}function f(b,c){if(!b.inputDevice||b.inputDevice.deviceId!==c.deviceId)return!1;t(b,null);b._inputDevice=null;b._maybeStopPollingVolume();var a=b.availableInputDevices.get("default")||Array.from(b.availableInputDevices.values())[0];a&&b.setInputDevice(a.deviceId);return!0}function w(b,c){return b.filter(function(b){return b.kind===
c})}function v(b){return b.deviceId}function e(b,a,r,p){var e=a.map(v),q=Array.from(r.values()).map(v),f=[],e=y.difference(q,e);e.forEach(function(c){var a=r.get(c);r["delete"](c);p(b,a)&&f.push(a)});var m=!1;a.forEach(function(a){var p=r.get(a.deviceId),e;e={deviceId:a.deviceId,groupId:a.groupId,kind:a.kind,label:a.label};if(!e.label)if("default"===e.deviceId)e.label="Default";else{var q=a.deviceId,f=a.kind,d=b._unknownDeviceIndexes;d[f]||(d[f]={});var v=d[f][q];v||(v=Object.keys(d[f]).length+1,
d[f][q]=v);e.label="Unknown "+C[e.kind]+" Device "+v}e=new c(e);p&&p.label===e.label||(r.set(a.deviceId,e),m=!0)});(m||e.length)&&b.emit("deviceChange",f)}function t(b,c){b._inputStream&&b._inputStream.getTracks().forEach(function(b){b.stop()});b._inputStream=c}var q=l("events").EventEmitter;k=l("util").inherits;var c=l("./shims/mediadeviceinfo"),b=l("./shims/mediadevices"),r=l("./outputdevicecollection"),p=l("./rtc/peerconnection").getUserMedia,y=l("./util");k(a,q);a.prototype._maybeStartPollingVolume=
function(){if(this.isVolumeSupported&&this._inputStream&&(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser),!this._isPollingInputVolume)){var b=new Uint8Array(this._inputVolumeAnalyser.frequencyBinCount),c=this;this._isPollingInputVolume=!0;requestAnimationFrame(function G(){if(c._isPollingInputVolume){c._inputVolumeAnalyser.getByteFrequencyData(b);
var a=y.average(b);c.emit("inputVolume",a/255);requestAnimationFrame(G)}})}};a.prototype._maybeStopPollingVolume=function(){!this.isVolumeSupported||!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._isPollingInputVolume=!1)};a.prototype.setInputDevice=function(b){if(y.isFirefox())return Promise.reject(Error("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"));
if("string"!==typeof b)return Promise.reject(Error("Must specify the device to set"));var c=this.availableInputDevices.get(b);if(!c)return Promise.reject(Error("Device not found: "+b));if(this._inputDevice&&this._inputDevice.deviceId===b&&this._inputStream)return Promise.resolve();var a=this;return this._getUserMedia({audio:{deviceId:{exact:b}}}).then(function(b){return a._onActiveInputChanged(b).then(function(){t(a,b);a._inputDevice=c;a._maybeStartPollingVolume()})})};a.prototype.unsetInputDevice=
function(){if(!this.inputDevice)return Promise.resolve();var b=this;return this._onActiveInputChanged(null).then(function(){t(b,null);b._inputDevice=null;b._maybeStopPollingVolume()})};a.prototype._unbind=function(){this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices);this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices)};var C={audiooutput:"Audio Output",audioinput:"Audio Input"};n.exports=a},{"./outputdevicecollection":10,"./rtc/peerconnection":16,
"./shims/mediadeviceinfo":19,"./shims/mediadevices":20,"./util":23,events:25,util:40}],4:[function(l,n,k){function a(c,b,r){function p(){}function e(){var b={call_sid:u.parameters.CallSid,client_name:c._clientName,sdk_version:w.getReleaseVersion(),selected_region:c.options.region};c.stream&&(c.stream.gateway&&(b.gateway=c.stream.gateway),c.stream.region&&(b.region=c.stream.region));b.direction=u._direction;return b}function v(){0!==A.length&&k.postMetrics("quality-metrics-samples","metrics-sample",
A.splice(0),e())}function h(b){var c={threshold:b.threshold.value};b.values?c.values=b.values.map(function(b){return"number"===typeof b?Math.round(100*b)/100:b}):b.value&&(c.value=b.value);return{data:c}}function l(b,c){var a=(/^audio/.test(c.name)?"audio-level-":"network-quality-")+"warning"+(b?"-cleared":"-raised"),r=q[c.threshold.name]+t[c.name];if("constant-audio-input-level"!==r||!u.isMuted()){var p=b?"info":"warning";"constant-audio-output-level"===r&&(p="info");k.post(p,a,r,h(c),u);"constant-audio-output-level"!==
r&&u.emit(b?"warning-cleared":"warning",r)}}if(!(this instanceof a))return new a(c,b,r);var u=this;w.monitorEventEmitter("Twilio.Connection",this);this.device=c;this.message=b||{};r=this.options=Object.assign({audioConstraints:c.options.audioConstraints,callParameters:{},debug:!1,encrypt:!1,iceServers:c.options.iceServers,logPrefix:"[Connection]",MediaStream:r.mediaStreamFactory||c.options.MediaStream||c.options.mediaStreamFactory||d.PeerConnection,offerSdp:null,rtcConstraints:c.options.rtcConstraints,
sinkIds:["default"]},r);this.parameters=r.callParameters;this._status="pending";this._direction=this.parameters.CallSid?"INCOMING":"OUTGOING";this.sendHangup=!0;m.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this._onHangup=this._onCancel=p;this._onAnswer=function(b){"undefined"!==typeof b.callsid&&(u.parameters.CallSid=b.callsid,u.mediaStream.callSid=b.callsid)};var k=this._publisher=r.publisher;"INCOMING"===this._direction&&k.info("connection",
"incoming",null,this);var n=this._monitor=new f;n.disableWarnings();var A=[],z=0;n.on("sample",function(b){20>z?z++:20===z&&n.enableWarnings();b.inputVolume=u._latestInputVolume;b.outputVolume=u._latestOutputVolume;A.push(b);10<=A.length&&v()});n.on("warning-cleared",l.bind(null,!0));n.on("warning",l.bind(null,!1));this.mediaStream=new this.options.MediaStream(this.options.encrypt,this.device,this.options.sinkIds,this.options.inputStream);this.on("volume",function(b,c){u._latestInputVolume=b;u._latestOutputVolume=
c});this.mediaStream.onvolume=this.emit.bind(this,"volume");this.mediaStream.oniceconnectionstatechange=function(b){k.post("failed"===b?"error":"debug","ice-connection-state",b,null,u)};this.mediaStream.onicegatheringstatechange=function(b){k.debug("signaling-state",b,null,u)};this.mediaStream.onsignalingstatechange=function(b){k.debug("signaling-state",b,null,u)};this.mediaStream.ondisconnect=function(b){u.log(b);k.warn("network-quality-warning-raised","ice-connectivity-lost",{message:b},u);u.emit("warning",
"ice-connectivity-lost")};this.mediaStream.onreconnect=function(b){u.log(b);k.info("network-quality-warning-cleared","ice-connectivity-lost",{message:b},u);u.emit("warning-cleared","ice-connectivity-lost")};this.mediaStream.onerror=function(b){!0===b.disconnect&&u._disconnect(b.info&&b.info.message);var c={code:b.info.code,message:b.info.message||"Error with mediastream",info:b.info,connection:u};u.log("Received an error from MediaStream:",b);u.emit("error",c)};this.mediaStream.onopen=function(){"open"!==
u._status&&("connecting"===u._status?(u._status="open",u.mute(!1),u.emit("accept",u)):u.mediaStream.close())};this.mediaStream.onclose=function(){u._status="closed";u.device.sounds.__dict__.disconnect&&u.device.soundcache.get("disconnect").play();n.disable();v();u.emit("disconnect",u)};this.outboundConnectionId=w.generateConnectionUUID();this.pstream=this.device.stream;this._onCancel=function(b){u.parameters.CallSid===b.callsid&&(u._status="closed",u.emit("cancel"),u.pstream.removeListener("cancel",
u._onCancel))};this.pstream&&this.pstream.addListener("cancel",this._onCancel);this.on("error",function(b){k.error("connection","error",{code:b.code,message:b.message},u);u.pstream&&"disconnected"===u.pstream.status&&g(u)});this.on("disconnect",function(){g(u)});return this}function g(c){function b(){c.pstream.removeListener("answer",c._onAnswer);c.pstream.removeListener("cancel",c._onCancel);c.pstream.removeListener("hangup",c._onHangup)}b();setTimeout(b,0)}n=l("events").EventEmitter;var h=l("./util").Exception,
m=l("./log"),d=l("./rtc"),f=l("./rtc/monitor"),w=l("./util"),v=[1,2,3,4,5],e="one-way-audio choppy-audio dropped-call audio-latency noisy-call echo".split(" "),t={audioOutputLevel:"audio-output-level",audioInputLevel:"audio-input-level",packetsLostFraction:"packet-loss",jitter:"jitter",rtt:"rtt",mos:"mos"},q={min:"low-",max:"high-",maxDuration:"constant-"};l("util").inherits(a,n);a.toString=function(){return"[Twilio.Connection class]"};a.prototype.toString=function(){return"[Twilio.Connection instance]"};
a.prototype.sendDigits=function(c){function b(c){if(c.length){var a=c.shift();a.length&&p.insertDTMF(a,160,70);setTimeout(b.bind(null,c),500)}}if(c.match(/[^0-9*#w]/))throw new h("Illegal character passed into sendDigits");var a=[];c.split("").forEach(function(b){b="w"!==b?"dtmf"+b:"";"dtmf*"===b&&(b="dtmfs");"dtmf#"===b&&(b="dtmfh");a.push(b)});(function C(b){var c=a.shift();b.get(c).play();a.length&&setTimeout(C.bind(null,b),200)})(this.device.soundcache);var p=this.mediaStream.getOrCreateDTMFSender();
if(p){if(!("canInsertDTMF"in p)||p.canInsertDTMF){this.log("Sending digits using RTCDTMFSender");b(c.split("w"));return}this.log("RTCDTMFSender cannot insert DTMF")}this.log("Sending digits over PStream");null!==this.pstream&&"disconnected"!==this.pstream.status?(c={dtmf:c,callsid:this.parameters.CallSid},this.pstream.publish("dtmf",c)):(c={error:{}},this.emit("error",{code:c.error.code||31E3,message:c.error.message||"Could not send DTMF: Signaling channel is disconnected",connection:this}))};a.prototype.status=
function(){return this._status};a.prototype.mute=function(c){if("undefined"===typeof c)c=!0,this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");else if("function"===typeof c){this.addListener("mute",c);return}this.isMuted()!==c&&(this.mediaStream.mute(c),c=this.isMuted(),this._publisher.info("connection",c?"muted":"unmuted",null,this),this.emit("mute",c,this))};a.prototype.isMuted=function(){return this.mediaStream.isMuted};a.prototype.unmute=
function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");this.mute(!1)};a.prototype.accept=function(c){function b(){function b(b){p._publisher.info("connection","accepted-by-local",null,p);p._monitor.enable(b)}function c(b){p._publisher.info("connection","accepted-by-remote",null,p);p._monitor.enable(b)}if("connecting"!==p._status)g(p),p.mediaStream.close();else{var a=[],r;for(r in p.message)a.push(encodeURIComponent(r)+"="+encodeURIComponent(p.message[r]));
a=a.join("&");"INCOMING"===p._direction?p.mediaStream.answerIncomingCall(p.parameters.CallSid,p.options.offerSdp,p.options.rtcConstraints,p.options.iceServers,b):(p.pstream.once("answer",p._onAnswer),p.mediaStream.makeOutgoingCall(a,p.outboundConnectionId,p.options.rtcConstraints,p.options.iceServers,c));p._onHangup=function(b){if(b.callsid&&(p.parameters.CallSid||p.outboundConnectionId)){if(b.callsid!==p.parameters.CallSid&&b.callsid!==p.outboundConnectionId)return}else if(b.callsid)return;p.log("Received HANGUP from gateway");
b.error&&(b={code:b.error.code||31E3,message:b.error.message||"Error sent from gateway in HANGUP",connection:p},p.log("Received an error from the gateway:",b),p.emit("error",b));p.sendHangup=!1;p._publisher.info("connection","disconnected-by-remote",null,p);p._disconnect(null,!0);g(p)};p.pstream.addListener("hangup",p._onHangup)}}if("function"===typeof c)this.addListener("accept",c);else if("pending"===this._status){var a=c||this.options.audioConstraints,p=this;this._status="connecting";(this.options.inputStream?
this.mediaStream.openWithStream(this.options.inputStream):this.mediaStream.openWithConstraints(a)).then(function(){p._publisher.info("get-user-media","succeeded",{data:{audioConstraints:a}},p);b()},function(b){var c,r;b.code&&b.code===b.PERMISSION_DENIED||b.name&&"PermissionDeniedError"===b.name?(r=31208,c="User denied access to microphone, or the web browser did not allow microphone access at this address.",p._publisher.error("get-user-media","denied",{data:{audioConstraints:a,error:b}},p)):(r=31201,
c="Error occurred while accessing microphone: "+b.name+(b.message?" ("+b.message+")":""),p._publisher.error("get-user-media","failed",{data:{audioConstraints:a,error:b}},p));return p._die(c,r)})}};a.prototype.reject=function(c){"function"===typeof c?this.addListener("reject",c):"pending"===this._status&&(this.pstream.publish("reject",{callsid:this.parameters.CallSid}),this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this))};
a.prototype.ignore=function(c){"function"===typeof c?this.addListener("cancel",c):"pending"===this._status&&(this._status="closed",this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this))};a.prototype.cancel=function(c){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(c)};a.prototype.disconnect=function(c){"function"===typeof c?this.addListener("disconnect",c):this._disconnect()};
a.prototype._disconnect=function(c,b){c="string"===typeof c?c:null;if("open"===this._status||"connecting"===this._status){this.log("Disconnecting...");if(null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var a=this.parameters.CallSid||this.outboundConnectionId;a&&(a={callsid:a},c&&(a.message=c),this.pstream.publish("hangup",a))}g(this);this.mediaStream.close();b||this._publisher.info("connection","disconnected-by-local",null,this)}};a.prototype.error=function(c){"function"===
typeof c&&this.addListener("error",c)};a.prototype._die=function(c,b){this._disconnect();this.emit("error",{message:c,code:b})};a.prototype._setSinkIds=function(c){return this.mediaStream._setSinkIds(c)};a.prototype._setInputTracksFromStream=function(c){return this.mediaStream.setInputTracksFromStream(c)};a.prototype.volume=function(c){if(!window||!window.AudioContext&&!window.webkitAudioContext)console.warn("This browser does not support Connection.volume");else if("function"===typeof c)this.on("volume",
c)};a.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream};a.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream};a.prototype.postFeedback=function(c,b){if("undefined"===typeof c||null===c)return this._postFeedbackDeclined();if(-1===v.indexOf(c))throw Error("Feedback score must be one of: "+v);if("undefined"!==typeof b&&null!==b&&-1===e.indexOf(b))throw Error("Feedback issue must be one of: "+e);return this._publisher.post("info",
"feedback","received",{quality_score:c,issue_name:b},this,!0)};a.prototype._postFeedbackDeclined=function(){return this._publisher.post("info","feedback","received-none",null,this,!0)};a.prototype._getTempCallSid=function(){return this.outboundConnectionId};a.prototype._getRealCallSid=function(){return/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid};k.Connection=a},{"./log":8,"./rtc":13,"./rtc/monitor":14,"./util":23,events:25,util:40}],5:[function(l,n,k){function a(b,r){function p(b){b=
b.forEach?b:[b];Array.from(x.soundcache.entries()).forEach(function(c){"incoming"!==c[0]&&c[1].setSinkIds(b)});x._connectionSinkIds=b;var c=x.activeConnection();return c?c._setSinkIds(b):Promise.resolve()}function m(b){return Promise.resolve(x.soundcache.get("incoming").setSinkIds(b))}function g(b){if("busy"===x._status||x.connections[0]){var c=!0===I?"A call is currently in-progress. Leaving or reloading this page will end the call.":I;return(b||window.event).returnValue=c}}function l(){x.disconnectAll()}
if(!w.enabled())throw new f.Exception("twilio.js 1.3 requires WebRTC/ORTC browser support. For more information, see <https://www.twilio.com/docs/api/client/twilio-js>. If you have any questions about this announcement, please contact Twilio Support at <help@twilio.com>.");if(!(this instanceof a))return new a(b,r);f.monitorEventEmitter("Twilio.Device",this);if(!b)throw new f.Exception("Capability token is not valid or missing.");r=r||{};for(var k in r);var u={logPrefix:"[Device]",chunderw:"chunderw-vpc-gll.twilio.com",
eventgw:"eventgw.twilio.com",Sound:r.soundFactory||t,connectionFactory:q,pStreamFactory:c,noRegister:!1,encrypt:!1,closeProtection:!1,secureSignaling:!0,warnings:!0,audioConstraints:!0,iceServers:[],region:"gll",dscp:!0,sounds:{}};r=r||{};k=r.chunderw;for(var n in u)n in r||(r[n]=u[n]);r.rtcConstraints=r.dscp?{optional:[{googDscp:!0}]}:{};this.options=r;this.token=b;this._region=this._status="offline";this._connectionSinkIds=["default"];this._connectionInputStream=null;this.connections=[];this.sounds=
new e({incoming:!0,outgoing:!0,disconnect:!0});d.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;n={gll:"chunderw-vpc-gll.twilio.com",au1:"chunderw-vpc-gll-au1.twilio.com",br1:"chunderw-vpc-gll-br1.twilio.com",ie1:"chunderw-vpc-gll-ie1.twilio.com",jp1:"chunderw-vpc-gll-jp1.twilio.com",sg1:"chunderw-vpc-gll-sg1.twilio.com",us1:"chunderw-vpc-gll-us1.twilio.com","us1-tnx":"chunderw-vpc-gll-us1-tnx.twilio.com","us2-tnx":"chunderw-vpc-gll-us2-tnx.twilio.com","ie1-tnx":"chunderw-vpc-gll-ie1-tnx.twilio.com"};
var u={au:"au1",br:"br1",ie:"ie1",jp:"jp1",sg:"sg1","us-va":"us1","us-or":"us1"},D=r.region.toLowerCase();D in u&&(this.log.deprecated("Region "+D+" is deprecated, please use "+u[D]+"."),D=u[D]);if(!(D in n))throw new f.Exception("Region "+r.region+" is invalid. Valid values are: "+Object.keys(n).join(", "));r.chunderw=k||n[D];this.soundcache=new Map;k="undefined"!==typeof document?document.createElement("audio"):{};var A;try{A=k.canPlayType&&!!k.canPlayType("audio/mpeg").replace(/no/,"")}catch(J){A=
!1}var z;try{z=k.canPlayType&&!!k.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(J){z=!1}k="mp3";z&&!A&&(k="ogg");A={incoming:{filename:"incoming",shouldLoop:!0,minDuration:2E3},outgoing:{filename:"outgoing",maxDuration:3E3},disconnect:{filename:"disconnect",maxDuration:3E3},dtmf1:{filename:"dtmf-1",maxDuration:1E3},dtmf2:{filename:"dtmf-2",maxDuration:1E3},dtmf3:{filename:"dtmf-3",maxDuration:1E3},dtmf4:{filename:"dtmf-4",maxDuration:1E3},dtmf5:{filename:"dtmf-5",maxDuration:1E3},
dtmf6:{filename:"dtmf-6",maxDuration:1E3},dtmf7:{filename:"dtmf-7",maxDuration:1E3},dtmf8:{filename:"dtmf-8",maxDuration:1E3},dtmf9:{filename:"dtmf-9",maxDuration:1E3},dtmf0:{filename:"dtmf-0",maxDuration:1E3},dtmfs:{filename:"dtmf-star",maxDuration:1E3},dtmfh:{filename:"dtmf-hash",maxDuration:1E3}};z=f.getTwilioRoot()+"sounds/releases/"+f.getSoundVersion()+"/";for(var E in A)n=A[E],u=z+n.filename+"."+k,n=new this.options.Sound(E,r.sounds[E]||u,{maxDuration:n.maxDuration,minDuration:n.minDuration,
shouldLoop:n.shouldLoop}),this.soundcache.set(E,n);var x=this,F=this._publisher=new v("twilio-js-sdk",this.token,{host:this.options.eventgw,defaultPayload:function(b){var c={client_name:x._clientName,platform:w.getMediaEngine(),sdk_version:f.getReleaseVersion(),selected_region:x.options.region};if(b){var a=b._getRealCallSid();a&&(c.call_sid=a);(a=b._getTempCallSid())&&(c.temp_call_sid=a);c.direction=b._direction}if(b=x.stream)(a=b.gateway)&&(c.gateway=a),(b=b.region)&&(c.region=b);return c}});!1===
r.publishEvents&&F.disable();(this.audio=new h(function(b,c){return("ringtone"===b?m(c):p(c)).then(function(){F.info("audio",b+"-devices-set",{audio_device_ids:c},x.activeConnection())},function(a){F.error("audio",b+"-devices-set-failed",{audio_device_ids:c,message:a.message},x.activeConnection());throw a;})},function(b){var c=x.activeConnection();if(c&&!b)return Promise.reject(Error("Cannot unset input device while a call is in progress."));x._connectionInputStream=b;return c?c._setInputTracksFromStream(b):
Promise.resolve()},{soundOptions:this.sounds})).on("deviceChange",function(b){var c=x.activeConnection();b=b.map(function(b){return b.deviceId});F.info("audio","device-change",{lost_active_device_ids:b},c);c&&c.mediaStream._onInputDevicesChanged()});this.mediaPresence={audio:!this.options.noRegister};this.register(this.token);var I=this.options.closeProtection;I&&"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("beforeunload",g):window.attachEvent&&window.attachEvent("onbeforeunload",
g));"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",l):window.attachEvent&&window.attachEvent("onunload",l));this.on("error",function(){});return this}function g(b,c,a){var r={sinkIds:b._connectionSinkIds,inputStream:b._connectionInputStream,debug:b.options.debug,encrypt:b.options.encrypt,warnings:b.options.warnings,publisher:b._publisher};a=a||{};for(var p in r)p in a||(a[p]=r[p]);var e=b.options.connectionFactory(b,c,a);e.once("accept",function(){b._status=
"busy";b.audio._maybeStartPollingVolume();b.emit("connect",e)});e.addListener("error",function(c){"closed"===e.status()&&b._removeConnection(e);b.audio._maybeStopPollingVolume();b.emit("error",c)});e.once("cancel",function(){b.log("Canceled: "+e.parameters.CallSid);b._removeConnection(e);b.audio._maybeStopPollingVolume();b.emit("cancel",e)});e.once("disconnect",function(){"busy"===b._status&&(b._status="ready");b.audio._maybeStopPollingVolume();b._removeConnection(e);b.emit("disconnect",e)});e.once("reject",
function(){b.log("Rejected: "+e.parameters.CallSid);b.audio._maybeStopPollingVolume();b._removeConnection(e)});return e}var h=l("./audiohelper");n=l("events").EventEmitter;var m=l("util"),d=l("./log"),f=l("./util"),w=l("./rtc"),v=l("./eventpublisher"),e=l("./options").Options,t=l("./sound"),q=l("./connection").Connection,c=l("./pstream").PStream;m.inherits(a,n);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.register=
function(b){var c=f.objectize(b);this._accountSid=c.iss;this._clientName=c.scope["client:incoming"]?c.scope["client:incoming"].params.clientName:null;this.stream&&"disconnected"!==this.stream.status?this.stream.setToken(b):this._setupStream()};a.prototype.registerPresence=function(){this.token&&(f.objectize(this.token).scope["client:incoming"]&&(this.mediaPresence.audio=!0),this._sendPresence())};a.prototype.unregisterPresence=function(){this.mediaPresence.audio=!1;this._sendPresence()};a.prototype.connect=
function(b,c){if("function"===typeof b)return this.addListener("connect",b);b=b||{};c=c||this.options.audioConstraints;var a=g(this,b);this.connections.push(a);if(this.sounds.__dict__.outgoing){var r=this;a.accept(function(){r.soundcache.get("outgoing").play()})}a.accept(c);return a};a.prototype.disconnectAll=function(){for(var b=[].concat(this.connections),c=0;c<b.length;c++)b[c].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};a.prototype.destroy=
function(){this._stopRegistrationTimer();this.audio._unbind();this.stream&&(this.stream.destroy(),this.stream=null)};a.prototype.disconnect=function(b){this.addListener("disconnect",b)};a.prototype.incoming=function(b){this.addListener("incoming",b)};a.prototype.offline=function(b){this.addListener("offline",b)};a.prototype.ready=function(b){this.addListener("ready",b)};a.prototype.error=function(b){this.addListener("error",b)};a.prototype.status=function(){return this._status};a.prototype.activeConnection=
function(){return this.connections[0]};a.prototype.region=function(){return this._region};a.prototype._sendPresence=function(){this.stream.register(this.mediaPresence);this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer()};a.prototype._startRegistrationTimer=function(){clearTimeout(this.regTimer);var b=this;this.regTimer=setTimeout(function(){b._sendPresence()},3E4)};a.prototype._stopRegistrationTimer=function(){clearTimeout(this.regTimer)};a.prototype._setupStream=
function(){var b=this;this.log("Setting up PStream");this.stream=this.options.pStreamFactory(this.token,{chunderw:this.options.chunderw,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.stream.addListener("connected",function(c){b._region={US_EAST_VIRGINIA:"us1",US_WEST_OREGON:"us2",ASIAPAC_SYDNEY:"au1",SOUTH_AMERICA_SAO_PAULO:"br1",EU_IRELAND:"ie1",ASIAPAC_TOKYO:"jp1",ASIAPAC_SINGAPORE:"sg1"}[c.region]||c.region;b._sendPresence()});this.stream.addListener("ready",function(){b.log("Stream is ready");
"offline"===b._status&&(b._status="ready");b.emit("ready",b)});this.stream.addListener("offline",function(){b.log("Stream is offline");b._status="offline";b._region="offline";b.emit("offline",b)});this.stream.addListener("error",function(c){var a=c.error;a&&(c.callsid&&(a.connection=b._findConnection(c.callsid)),31205===a.code&&b._stopRegistrationTimer(),b.log("Received error: ",a),b.emit("error",a))});this.stream.addListener("invite",function(c){function a(){b.connections.length||b.soundcache.get("incoming").stop()}
if("busy"===b._status)b.log("Device busy; ignoring incoming invite");else if(c.callsid&&c.sdp){var e=c.parameters||{};e.CallSid=e.CallSid||c.callsid;var r=g(b,{},{offerSdp:c.sdp,callParameters:e});b.connections.push(r);r.once("accept",function(){b.soundcache.get("incoming").stop()});["cancel","error","reject"].forEach(function(b){r.once(b,a)});b._showIncomingConnection(r,b.sounds.__dict__.incoming?function(){return b.soundcache.get("incoming").play()}:function(){return Promise.resolve()})}else b.emit("error",
{message:"Malformed invite from gateway"})})};a.prototype._showIncomingConnection=function(b,c){var a=this,e;return Promise.race([c(),new Promise(function(b,c){e=setTimeout(function(){c(Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))},2E3)})])["catch"](function(b){console.warn(b.message)}).then(function(){clearTimeout(e);a.emit("incoming",b)})};a.prototype._removeConnection=function(b){for(var c=this.connections.length-1;0<=c;c--)b===this.connections[c]&&
this.connections.splice(c,1)};a.prototype._findConnection=function(b){for(var c=0;c<this.connections.length;c++){var a=this.connections[c];if(a.parameters.CallSid===b||a.outboundConnectionId===b)return a}return null};k.Device=function(b){function c(c){b.instance?c():d.push(c)}function e(c){c=(c.code?c.code+": ":"")+c.message;if(b.instance){for(var a=0,r=b.instance.listeners("error"),p=0;p<r.length;p++)r[p]!==e&&a++;if(1<a)return;b.instance.log(c)}throw new f.Exception(c);}var q=[],d=[],m={instance:null,
setup:function(c,r){var p;if(b.instance)b.instance.log("Found existing Device; using new token but ignoring options"),b.instance.token=c,b.instance.register(c);else{b.instance=new a(c,r);b.error(e);b.sounds=b.instance.sounds;for(p=0;p<d.length;p++)d[p]();d=[]}for(p=0;p<q.length;p++)q[p](c,r);q=[];return b},connect:function(a,e){if("function"===typeof a)return c(function(){b.instance.addListener("connect",a)}),null;if(!b.instance)throw new f.Exception("Run Twilio.Device.setup()");return 0<b.instance.connections.length?
(b.instance.emit("error",{message:"A connection is currently active"}),null):b.instance.connect(a,e)},disconnectAll:function(){c(function(){b.instance.disconnectAll()});return b},disconnect:function(a){c(function(){b.instance.addListener("disconnect",a)});return b},status:function(){if(!b.instance)throw new f.Exception("Run Twilio.Device.setup()");return b.instance.status()},region:function(){if(!b.instance)throw new f.Exception("Run Twilio.Device.setup()");return b.instance.region()},ready:function(a){c(function(){b.instance.addListener("ready",
a)});return b},error:function(a){c(function(){a!==e&&b.instance.removeListener("error",e);b.instance.addListener("error",a)});return b},offline:function(a){c(function(){b.instance.addListener("offline",a)});return b},incoming:function(a){c(function(){b.instance.addListener("incoming",a)});return b},destroy:function(){b.instance&&b.instance.destroy();return b},cancel:function(a){c(function(){b.instance.addListener("cancel",a)});return b},activeConnection:function(){return b.instance?b.instance.activeConnection():
null}},v;for(v in m)b[v]=m[v];Object.defineProperties(b,{audio:{get:function(){return b.instance.audio}}});return b}(a)},{"./audiohelper":3,"./connection":4,"./eventpublisher":6,"./log":8,"./options":9,"./pstream":11,"./rtc":13,"./sound":21,"./util":23,events:25,util:40}],6:[function(l,n,k){function a(m,d,f){if(!(this instanceof a))return new a(m,d,f);f=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},f);var g=f.defaultPayload;"function"!==typeof g&&(g=function(){return Object.assign({},
f.defaultPayload)});var v=!0;Object.defineProperties(this,{_defaultPayload:{value:g},_isEnabled:{get:function(){return v},set:function(a){v=a}},_host:{value:f.host},_request:{value:f.request||h},isEnabled:{enumerable:!0,get:function(){return v}},productName:{enumerable:!0,value:m},token:{enumerable:!0,value:d}})}function g(a){return{timestamp:(new Date(a.timestamp)).toISOString(),total_packets_received:a.totals.packetsReceived,total_packets_lost:a.totals.packetsLost,total_packets_sent:a.totals.packetsSent,
total_bytes_received:a.totals.bytesReceived,total_bytes_sent:a.totals.bytesSent,packets_received:a.packetsReceived,packets_lost:a.packetsLost,packets_lost_fraction:a.packetsLostFraction&&Math.round(100*a.packetsLostFraction)/100,audio_level_in:a.audioInputLevel,audio_level_out:a.audioOutputLevel,call_volume_input:a.inputVolume,call_volume_output:a.outputVolume,jitter:a.jitter,rtt:a.rtt,mos:a.mos&&Math.round(100*a.mos)/100}}var h=l("./request");a.prototype._post=function(a,d,f,h,v,e,g){if(!this.isEnabled&&
!g)return Promise.resolve();d={publisher:this.productName,group:f,name:h,timestamp:(new Date).toISOString(),level:d.toUpperCase(),payload_type:"application/json","private":!1,payload:v&&v.forEach?v.slice(0):Object.assign(this._defaultPayload(e),v)};var q={url:"https://"+this._host+"/v2/"+a,body:d,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},c=this;return new Promise(function(b,a){c._request.post(q,function(c){c?a(c):b()})})};a.prototype.post=function(a,d,f,h,v,e){return this._post("EndpointEvents",
a,d,f,h,v,e)};a.prototype.debug=function(a,d,f,h){return this.post("debug",a,d,f,h)};a.prototype.info=function(a,d,f,h){return this.post("info",a,d,f,h)};a.prototype.warn=function(a,d,f,h){return this.post("warning",a,d,f,h)};a.prototype.error=function(a,d,f,h){return this.post("error",a,d,f,h)};a.prototype.postMetrics=function(a,d,f,h){f=f.map(g).map(function(a){return Object.assign(a,h)});return this._post("EndpointMetrics","info",a,d,f)};a.prototype.enable=function(){this._isEnabled=!0};a.prototype.disable=
function(){this._isEnabled=!1};n.exports=a},{"./request":12}],7:[function(l,n,k){function a(g){function h(){}if(!(this instanceof a))return new a(g);g=g||{};var m={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,d){return setInterval(a,d)},stop:function(a,d){return clearInterval(a,d)},onsleep:h,onwakeup:h},d;for(d in m)d in g||(g[d]=m[d]);this.interval=g.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=g.onsleep;this.onwakeup=g.onwakeup;this.repeat=g.repeat;this.stop=
g.stop;this.now=g.now}a.toString=function(){return"[Twilio.Heartbeat class]"};a.prototype.toString=function(){return"[Twilio.Heartbeat instance]"};a.prototype.beat=function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},1E3*this.interval)}};a.prototype.check=function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);
this.pintvl=null}};a.prototype.sleeping=function(){return null===this.pintvl};k.Heartbeat=a},{}],8:[function(l,n,k){k.mixinLog=function(a,g){function h(){if(h.enabled)for(var a=h.prefix?h.prefix+" ":"",d=0;d<arguments.length;d++){var f=arguments[d];h.handler("string"===typeof f?a+f:f)}}h.enabled=!0;h.prefix=g||"";h.defaultHandler=function(a){"undefined"!==typeof console&&console.log(a)};h.handler=h.defaultHandler;h.warnings=!0;h.defaultWarnHandler=function(a){"undefined"!==typeof console&&("function"===
typeof console.warn?console.warn(a):"function"===typeof console.log&&console.log(a))};h.warnHandler=h.defaultWarnHandler;h.deprecated=function(){if(h.warnings)for(var a=0;a<arguments.length;a++)h.warnHandler(arguments[a])};a.log=h}},{}],9:[function(l,n,k){var a=l("./log");k.Options=function(){function g(d,f){if(!(this instanceof g))return new g(d);this.__dict__={};d=d||{};f=f||{};a.mixinLog(this,"[Sounds]");for(var m in d)this[m]=h(this.__dict__,m,this.log),this[m](d[m]);for(m in f)this[m](f[m])}
function h(a,f,h){return function(d){m||(m=!0,h.deprecated("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio."));"undefined"!==typeof d&&(a[f]=d);return a[f]}}var m=!1;return g}()},{"./log":8}],10:[function(l,n,k){function a(a,m,d,f){Object.defineProperties(this,{_activeDevices:{value:new Set},_availableDevices:{value:m},_beforeChange:{value:d},_isSupported:{value:f},_name:{value:a}})}l=l("./util");var g=l.getTwilioRoot()+
"sounds/releases/"+l.getSoundVersion()+"/outgoing.mp3";a.prototype._delete=function(a){a=this._activeDevices["delete"](a);this._activeDevices.size||this._activeDevices.add(this._availableDevices.get("default"));var h=Array.from(this._activeDevices).map(function(a){return a.deviceId});this._beforeChange(this._name,h);return a};a.prototype.get=function(){return this._activeDevices};a.prototype.set=function(a){if(!this._isSupported)return Promise.reject(Error("This browser does not support audio output selection"));
a=Array.isArray(a)?a:[a];if(!a.length)return Promise.reject(Error("Must specify at least one device to set"));var h=[],d=a.map(function(a){var d=this._availableDevices.get(a);d||h.push(a);return d},this);if(h.length)return Promise.reject(Error("Devices not found: ",h.join(", ")));var f=this;return(new Promise(function(d){d(f._beforeChange(f._name,a))})).then(function(){f._activeDevices.clear();d.forEach(f._activeDevices.add,f._activeDevices)})};a.prototype.test=function(a){if(!this._isSupported)return Promise.reject(Error("This browser does not support audio output selection"));
a=a||g;return this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(h){var d=new Audio([a]);return d.setSinkId(h.deviceId).then(function(){return d.play()})})):Promise.reject(Error("No active output devices to test"))};n.exports=a},{"./util":23}],11:[function(l,n,k){function a(f,g){if(!(this instanceof a))return new a(f,g);m.monitorEventEmitter("Twilio.PStream",this);var v={logPrefix:"[PStream]",chunderw:"chunderw-vpc-gll.twilio.com",secureSignaling:!0,transportFactory:d,
debug:!1};g=g||{};for(var e in v)e in g||(g[e]=v[e]);this.options=g;this.token=f||"";this.status="disconnected";this.host=this.options.chunderw;this.region=this.gateway=null;h.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.on("error",function(){});var t=this;this.addListener("ready",function(){t.status="ready"});this.addListener("offline",function(){t.status="offline"});this.addListener("close",function(){t.destroy()});this.transport=this.options.transportFactory({host:this.host,
debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.transport.onopen=function(){t.status="connected";t.setToken(t.token)};this.transport.onclose=function(){"disconnected"!==t.status&&("offline"!==t.status&&t.emit("offline",t),t.status="disconnected")};this.transport.onerror=function(a){t.emit("error",a)};this.transport.onmessage=function(a){a=m.splitObjects(a.data);for(var c=0;c<a.length;c++){var b=JSON.parse(a[c]),e=b.type,b=b.payload||{};b.gateway&&(t.gateway=b.gateway);
b.region&&(t.region=b.region);t.emit(e,b)}};this.transport.open();return this}n=l("events").EventEmitter;var g=l("util"),h=l("./log"),m=l("./util"),d=l("./wstransport").WSTransport;g.inherits(a,n);a.toString=function(){return"[Twilio.PStream class]"};a.prototype.toString=function(){return"[Twilio.PStream instance]"};a.prototype.setToken=function(a){this.log("Setting token and publishing listen");this.token=a;a={token:a,browserinfo:m.getSystemInfo()};this.publish("listen",a)};a.prototype.register=
function(a){this.publish("register",{media:a})};a.prototype.destroy=function(){this.log("Closing PStream");this.transport.close();return this};a.prototype.publish=function(a,d){var f=JSON.stringify({type:a,version:m.getPStreamVersion(),payload:d});this.transport.send(f)};k.PStream=a},{"./log":8,"./util":23,"./wstransport":24,events:25,util:40}],12:[function(l,n,k){var a="undefined"===typeof XMLHttpRequest?l("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;l=function(g,h,m){var d;d=d||a;var f=new d;
f.open(g,h.url,!0);f.onreadystatechange=function(){4===f.readyState&&(200<=f.status&&300>f.status?m(null,f.responseText):m(Error(f.responseText)))};for(var k in h.headers)f.setRequestHeader(k,h.headers[k]);f.send(JSON.stringify(h.body))};l.get=function(a,h){return new this("GET",a,h)};l.post=function(a,h){return new this("POST",a,h)};n.exports=l},{xmlhttprequest:42}],13:[function(l,n,k){var a=l("./peerconnection");n.exports={enabled:function(g){"undefined"!==typeof g&&(a.enabled=g);return a.enabled},
getMediaEngine:function(){return"undefined"!==typeof RTCIceGatherer?"ORTC":"WebRTC"},PeerConnection:a}},{"./peerconnection":16}],14:[function(l,n,k){function a(d){if(!(this instanceof a))return new a(d);d=d||{};var e=Object.assign({},w,d.thresholds);Object.defineProperties(this,{_activeWarnings:{value:new Map},_currentStreaks:{value:new Map},_peerConnection:{value:d.peerConnection,writable:!0},_sampleBuffer:{value:[]},_sampleInterval:{value:null,writable:!0},_thresholds:{value:e},_warningsEnabled:{value:!0,
writable:!0}});d.peerConnection&&this.enable();m.call(this)}function g(a,e){return e.reduce(function(e,d){return e+(d<a?1:0)},0)}function h(a,e){return e.reduce(function(e,d){return e+(d>a?1:0)},0)}var m=l("events").EventEmitter,d=l("./stats");k=l("util").inherits;var f=l("./mos"),w={audioInputLevel:{maxDuration:10},audioOutputLevel:{maxDuration:10},packetsLostFraction:{max:1},jitter:{max:30},rtt:{max:400},mos:{min:3}};k(a,m);a.createSample=function(a,e){var d=a.packetsReceived-(e&&e.totals.packetsReceived||
0),q=a.packetsLost-(e&&e.totals.packetsLost||0),c=d+q,c=0<c?q/c*100:100,b=a.packetsReceived+a.packetsLost;return{timestamp:a.timestamp,totals:{packetsReceived:a.packetsReceived,packetsLost:a.packetsLost,packetsSent:a.packetsSent,packetsLostFraction:0<b?a.packetsLost/b*100:100,bytesReceived:a.bytesReceived,bytesSent:a.bytesSent},packetsSent:a.packetsSent-(e&&e.totals.packetsSent||0),packetsReceived:d,packetsLost:q,packetsLostFraction:c,audioInputLevel:a.audioInputLevel,audioOutputLevel:a.audioOutputLevel,
jitter:a.jitter,rtt:a.rtt,mos:f.calculate(a,e&&c)}};a.prototype.enable=function(a){if(a){if(this._peerConnection&&a!==this._peerConnection)throw Error("Attempted to replace an existing PeerConnection in RTCMonitor.enable");this._peerConnection=a}if(!this._peerConnection)throw Error("Can not enable RTCMonitor without a PeerConnection");this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),1E3);return this};a.prototype.disable=function(){clearInterval(this._sampleInterval);
this._sampleInterval=null;return this};a.prototype.getSample=function(){var f=this;return d(this._peerConnection).then(function(e){return a.createSample(e,f._sampleBuffer.length&&f._sampleBuffer[f._sampleBuffer.length-1])})};a.prototype._fetchSample=function(){var a=this;return this.getSample().then(function(e){a._addSample(e);a._raiseWarnings();a.emit("sample",e);return e},function(e){a.disable();a.emit("error",e)})};a.prototype._addSample=function(a){var e=this._sampleBuffer;e.push(a);5<e.length&&
e.splice(0,e.length-5)};a.prototype._raiseWarnings=function(){if(this._warningsEnabled)for(var a in this._thresholds)this._raiseWarningsForStat(a)};a.prototype.enableWarnings=function(){this._warningsEnabled=!0;return this};a.prototype.disableWarnings=function(){this._warningsEnabled&&this._activeWarnings.clear();this._warningsEnabled=!1;return this};a.prototype._raiseWarningsForStat=function(a){var e=this._sampleBuffer,d=this._thresholds[a],q=e.slice(-5),q=q.map(function(b){return b[a]});if(!q.some(function(b){return"undefined"===
typeof b||null===b})){var c;"number"===typeof d.max&&(c=h(d.max,q),3<=c?this._raiseWarning(a,"max",{values:q}):0>=c&&this._clearWarning(a,"max",{values:q}));"number"===typeof d.min&&(c=g(d.min,q),3<=c?this._raiseWarning(a,"min",{values:q}):0>=c&&this._clearWarning(a,"min",{values:q}));"number"===typeof d.maxDuration&&1<e.length&&(q=e.slice(-2),e=q[0][a],c=q[1][a],q=this._currentStreaks.get(a)||0,e=e===c?q+1:0,this._currentStreaks.set(a,e),e>=d.maxDuration?this._raiseWarning(a,"maxDuration",{value:e}):
0===e&&this._clearWarning(a,"maxDuration",{value:q}))}};a.prototype._clearWarning=function(a,e,d){var q=a+":"+e,c=this._activeWarnings.get(q);!c||5E3>Date.now()-c.timeRaised||(this._activeWarnings["delete"](q),this.emit("warning-cleared",Object.assign({name:a,threshold:{name:e,value:this._thresholds[a][e]}},d)))};a.prototype._raiseWarning=function(a,e,d){var q=a+":"+e;this._activeWarnings.has(q)||(this._activeWarnings.set(q,{timeRaised:Date.now()}),this.emit("warning",Object.assign({name:a,threshold:{name:e,
value:this._thresholds[a][e]}},d)))};n.exports=a},{"./mos":15,"./stats":17,events:25,util:40}],15:[function(l,n,k){n.exports={calculate:function(a,g){if(!a||"number"!==typeof a.rtt||"number"!==typeof a.jitter||"number"!==typeof a.packetsLost||"number"!==typeof g)return null;var h,m=a.rtt+2*a.jitter+10;h=0;switch(!0){case 160>m:h=94.768-m/40;break;case 1E3>m:h=94.768-(m-120)/10;break;case 1E3<=m:h=94.768-m/100}m=.01;switch(!0){case -1===g:h=m=0;break;case g<=h/2.5:m=2.5;break;case g>h/2.5&&100>g:m=
.25}h-=g*m;h=1+.035*h+7E-6*h*(h-60)*(100-h);return 1<=h&&4.6>h?h:null}}},{}],16:[function(l,n,k){function a(c,b,e){function d(){}if(!(this instanceof a))return new a(c,b,e);this.onvolume=this.onicecandidate=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onreconnect=this.ondisconnect=this.onclose=this.onerror=this.onopen=d;this.version=null;this.pstream=b.stream;this.stream=null;this.device=b;this.sinkIds=new Set(e||["default"]);this.outputs=new Map;this.status="connecting";this.callSid=
null;this.isMuted=!1;c="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);this._isSinkSupported=!!c&&"undefined"!==typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId;this._audioContext=c&&b.audio._audioContext;this._dtmfSender=this._mediaStreamSource=this._masterAudioDeviceId=this._masterAudio=null;this._dtmfSenderUnsupported=!1;this._callEvents=[];this._nextTimeToPublish=Date.now();this._onAnswer=d;this._remoteStream=null;this._shouldManageStream=this._shouldStopTracks=
!0;f.mixinLog(this,"[Twilio.PeerConnection]");this.log.enabled=this.device.options.debug;this.log.warnings=this.device.options.warnings;this._iceConnectionStateMachine=new v(t,"new");this._signalingStateMachine=new v(q,"stable");return this}function g(a,b){var c=b.createAnalyser();c.fftSize=32;c.smoothingTimeConstant=.3;b.createMediaStreamSource(a).connect(c);return c}function h(a,b){var c=a.outputs.get(b);c&&(c.audio&&(c.audio.pause(),c.audio.src=""),c.dest&&c.dest.disconnect())}function m(a,b){var c=
a.outputs.get(b);a.outputs["delete"](b);var e=Array.from(a.outputs.keys())[0]||"default";return c.audio.setSinkId(e).then(function(){h(a,e);a.outputs.set(e,c);a._masterAudioDeviceId=e},function(e){a.outputs.set(b,c);throw e;})}function d(){"undefined"===typeof window?this.log("No RTCPeerConnection implementation available. The window object was not found."):e.isEdge()?(this.RTCPeerConnection=w.RTCPeerConnection,window.RTCSessionDescription=w.RTCSessionDescription,window.RTCIceCandidate=w.RTCIceCandidate):
"function"===typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"===typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log("No RTCPeerConnection implementation available")}var f=l("../log"),w=l("ortc-adapter"),v=l("../statemachine"),e=l("../util"),t={"new":["checking","closed"],checking:["new","connected","failed","closed","completed"],
connected:["new","disconnected","completed","closed"],completed:["new","disconnected","closed","completed"],failed:["new","disconnected","closed"],disconnected:["connected","completed","failed","closed"],closed:[]},q={stable:["have-local-offer","have-remote-offer","closed"],"have-local-offer":["stable","closed"],"have-remote-offer":["stable","closed"],closed:[]};a.prototype.uri=function(){return this._uri};a.prototype.openWithConstraints=function(c){return a.getUserMedia({audio:c}).then(this._setInputTracksFromStream.bind(this,
!1))};a.prototype.openWithStream=function(a){var b=this;return this._setInputTracksFromStream(!0,a).then(function(){b._shouldManageStream=!1})};a.prototype.setInputTracksFromStream=function(a){var b=this;return this._setInputTracksFromStream(!0,a).then(function(){b._shouldStopTracks=!1;b._shouldManageStream=!1})};a.prototype._setVolumeHandler=function(a){this.onvolume=a};a.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var a=this._audioContext,b=(this._inputAnalyser=
g(this.stream,a)).frequencyBinCount,d=new Uint8Array(b),a=(this._outputAnalyser=g(this._remoteStream,a)).frequencyBinCount,p=new Uint8Array(a),q=this;requestAnimationFrame(function B(){if(q._audioContext)if("closed"===q.status)q._inputAnalyser.disconnect(),q._outputAnalyser.disconnect();else{q._inputAnalyser.getByteFrequencyData(d);var b=e.average(d);q._outputAnalyser.getByteFrequencyData(p);var a=e.average(p);q.onvolume(b/255,a/255);requestAnimationFrame(B)}})}};a.prototype._stopStream=function(a){this._shouldStopTracks&&
("function"===typeof MediaStreamTrack.prototype.stop?("function"===typeof a.getAudioTracks?a.getAudioTracks():a.audioTracks).forEach(function(b){b.stop()}):a.stop())};a.prototype._setInputTracksFromStream=function(a,b){var c=this;if(!b)return Promise.reject(Error("Can not set input stream to null while in a call"));if(!b.getAudioTracks().length)return Promise.reject(Error("Supplied input stream has no audio tracks"));var e=this.stream;if(e){this._stopStream(e);var d="function"===typeof this.version.pc.addTrack&&
"function"===typeof this.version.pc.removeTrack;d||this.version.pc.removeStream(e);e.getAudioTracks().forEach(function(b){e.removeTrack(b);d&&c.version.pc.removeTrack(b)});b.getAudioTracks().forEach(function(b){e.addTrack(b);d&&c.version.pc.addTrack(b)});d||this.version.pc.addStream(e)}else this.stream=a?b.clone():b;this.mute(this.isMuted);return this.version?new Promise(function(b,a){c.version.createOffer({audio:!0},function(){c.version.processAnswer(c._answerSdp,function(){c._inputAnalyser=g(c.stream,
c._audioContext);b(c.stream)},a)},a)}):Promise.resolve(this.stream)};a.prototype._onInputDevicesChanged=function(){this.stream&&this.stream.getAudioTracks().every(function(a){return"ended"===a.readyState})&&this._shouldManageStream&&this.openWithConstraints(!0)};a.prototype._setSinkIds=function(a){if(!this._isSinkSupported)return Promise.reject("Audio output selection is not supported by this browser");this.sinkIds=new Set(a.forEach?a:[a]);return this._updateAudioOutputs()};a.prototype._updateAudioOutputs=
function(){var a=Array.from(this.sinkIds).filter(function(b){return!this.outputs.has(b)},this),b=Array.from(this.outputs.keys()).filter(function(b){return!this.sinkIds.has(b)},this),e=this,a=a.map(this._createAudioOutput,this);return Promise.all(a).then(function(){return Promise.all(b.map(e._removeAudioOutput,e))})};a.prototype._createAudioOutput=function(a){var b=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(b);var c=(window.URL||window.webkitURL).createObjectURL(b.stream),
e=new Audio([c]),d=this;return e.setSinkId(a).then(function(){return e.play()}).then(function(){d.outputs.set(a,{audio:e,dest:b})})};a.prototype._removeAudioOutputs=function(){return Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)};a.prototype._removeAudioOutput=function(a){if(this._masterAudioDeviceId===a)return m(this,a);h(this,a);this.outputs["delete"](a);return Promise.resolve()};a.prototype._setupPeerConnection=function(c,b){var e=a.protocol;e.create(this.log,c,b);e.pc.addStream(this.stream);
var d=this;e.pc.onaddstream=function(b){d._remoteStream=b.stream;if(d._isSinkSupported){var a=(window.URL||window.webkitURL).createObjectURL(b.stream),a=d._masterAudio=new Audio([a]);a.play();var c=Array.from(d.outputs.keys())[0]||"default";d._masterAudioDeviceId=c;d.outputs.set(c,{audio:a});d._mediaStreamSource=d._audioContext.createMediaStreamSource(b.stream);d.pcStream=b.stream;d._updateAudioOutputs()}else a=document&&document.createElement("audio"),a.autoplay=!0,"undefined"!==typeof a.srcObject?
a.srcObject=b.stream:"undefined"!==typeof a.mozSrcObject?a.mozSrcObject=b.stream:"undefined"!==typeof a.src?a.src=(window.URL||window.webkitURL).createObjectURL(b.stream):d.log("Error attaching stream to element."),d.outputs.set("default",{audio:a});d._startPollingVolume()};return e};a.prototype._setupChannel=function(){var a=this,b=this.version.pc;a.version.pc.onopen=function(){a.status="open";a.onopen()};a.version.pc.onstatechange=function(){a.version.pc&&"stable"===a.version.pc.readyState&&(a.status=
"open",a.onopen())};a.version.pc.onsignalingstatechange=function(){var c=b.signalingState;a.log('signalingState is "'+c+'"');try{a._signalingStateMachine.transition(c)}catch(p){a.log("Failed to transition to signaling state "+c+": "+p)}a.version.pc&&"stable"===a.version.pc.signalingState&&(a.status="open",a.onopen());a.onsignalingstatechange(b.signalingState)};b.onicecandidate=function(b){a.onicecandidate(b.candidate)};b.oniceconnectionstatechange=function(){var c=b.iceConnectionState,e=a._iceConnectionStateMachine.currentState;
try{a._iceConnectionStateMachine.transition(c)}catch(y){a.log("Failed to transition to ice connection state "+c+": "+y)}switch(c){case "connected":"disconnected"===e&&(e="ICE liveliness check succeeded. Connection with Twilio restored",a.log(e),a.onreconnect(e));break;case "disconnected":e="ICE liveliness check failed. May be having trouble connecting to Twilio";a.log(e);a.ondisconnect(e);break;case "failed":e=("checking"===e?"ICE negotiation with Twilio failed.":"Connection with Twilio was interrupted.")+
" Call will terminate.";a.log(e);a.onerror({info:{code:31003,message:e},disconnect:!0});break;default:a.log('iceConnectionState is "'+c+'"')}a.oniceconnectionstatechange(c)}};a.prototype._initializeMediaStream=function(a,b){if("open"===this.status)return!1;if("disconnected"===this.pstream.status)return this.onerror({info:{code:31E3,message:"Cannot establish connection. Client is disconnected"}}),this.close(),!1;this.version=this._setupPeerConnection(a,b);this._setupChannel();return!0};a.prototype.makeOutgoingCall=
function(a,b,d,q,f){function c(){f(p.version.pc)}function r(b){p.onerror({info:{code:31E3,message:"Error processing answer: "+(b.message||b)}})}if(this._initializeMediaStream(d,q)){var p=this;this.callSid=b;this._onAnswer=function(b){p._answerSdp=b.sdp;"closed"!==p.status&&p.version.processAnswer(b.sdp,c,r)};this.pstream.once("answer",this._onAnswer);this.version.createOffer({audio:!0},function(){"closed"!==p.status&&p.pstream.publish("invite",{sdp:p.version.getSDP(),callsid:p.callSid,twilio:{accountsid:p.device.token?
e.objectize(p.device.token).iss:null,params:a}})},function(b){p.onerror({info:{code:31E3,message:"Error creating the offer: "+(b.message||b)}})})}};a.prototype.answerIncomingCall=function(a,b,e,d,q){if(this._initializeMediaStream(e,d)){this._answerSdp=b.replace(/^a=setup:actpass$/gm,"a=setup:passive");this.callSid=a;var c=this;this.version.processSDP(b,{audio:!0},function(){"closed"!==c.status&&(c.pstream.publish("answer",{callsid:a,sdp:c.version.getSDP()}),q(c.version.pc))},function(b){c.onerror({info:{code:31E3,
message:"Error creating the answer: "+(b.message||b)}})})}};a.prototype.close=function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null);this.stream&&(this.mute(!1),this._stopStream(this.stream));this.stream=null;this.pstream&&this.pstream.removeListener("answer",this._onAnswer);this._removeAudioOutputs();this._mediaStreamSource&&this._mediaStreamSource.disconnect();this._inputAnalyser&&this._inputAnalyser.disconnect();this._outputAnalyser&&
this._outputAnalyser.disconnect();this.status="closed";this.onclose()};a.prototype.reject=function(a){this.callSid=a};a.prototype.ignore=function(a){this.callSid=a};a.prototype.mute=function(a){this.isMuted=a;this.stream&&(("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks)[0].enabled=!a)};a.getUserMedia=function(a){return(new Promise(function(b,c){if("undefined"===typeof navigator)c(Error("getUserMedia is not supported"));else switch("function"){case typeof(navigator.mediaDevices&&
navigator.mediaDevices.getUserMedia):b(navigator.mediaDevices.getUserMedia(a));break;case typeof navigator.webkitGetUserMedia:navigator.webkitGetUserMedia(a,b,c);break;case typeof navigator.mozGetUserMedia:navigator.mozGetUserMedia(a,b,c);break;case typeof navigator.getUserMedia:navigator.getUserMedia(a,b,c);break;default:c(Error("getUserMedia is not supported"))}}))["catch"](function(b){throw e.isFirefox()&&"NotReadableError"===b.name?Error("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):
b;})};a.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender)return this._dtmfSender;if(this._dtmfSenderUnsupported)return null;var a=this.version.pc;if(!a)return this.log("No RTCPeerConnection available to call createDTMFSender on"),null;for(var b=a.getLocalStreams(),e,d,q=0;q<b.length;q++)if(e=b[q],e="function"===typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks,e.length){d=e[0];break}if(!d)return this.log("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),
null;if("function"===typeof a.getSenders&&(b=a.getSenders().find(function(a){return a.track===d}),b.dtmf))return this.log("Using RTCRtpSender#dtmf"),this._dtmfSender=b.dtmf;if("function"===typeof a.createDTMFSender)return this.log("Creating RTCDTMFSender"),this._dtmfSender=a.createDTMFSender(d);this.log("RTCPeerConnection does not support RTCDTMFSender");this._dtmfSenderUnsupported=!0;return null};d.prototype.create=function(a,b,e){this.log=a;this.pc=new this.RTCPeerConnection({iceServers:e},b)};
d.prototype.createModernConstraints=function(a){if("undefined"===typeof a)return null;var b={};"undefined"!==typeof webkitRTCPeerConnection?(b.mandatory={},"undefined"!==typeof a.audio&&(b.mandatory.OfferToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.mandatory.OfferToReceiveVideo=a.video)):("undefined"!==typeof a.audio&&(b.offerToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.offerToReceiveVideo=a.video));return b};d.prototype.createOffer=function(a,b,e){var c=this;this.pc.createOffer(function(a){c.pc&&
c.pc.setLocalDescription(new RTCSessionDescription(a),b,e)},e,this.createModernConstraints(a))};d.prototype.createAnswer=function(a,b,e){var c=this;this.pc.createAnswer(function(a){c.pc&&c.pc.setLocalDescription(new RTCSessionDescription(a),b,e)},e,this.createModernConstraints(a))};d.prototype.processSDP=function(a,b,e,d){var c=this;a=new RTCSessionDescription({sdp:a,type:"offer"});this.pc.setRemoteDescription(a,function(){c.createAnswer(b,e,d)},d)};d.prototype.getSDP=function(){return this.pc.localDescription.sdp};
d.prototype.processAnswer=function(a,b,e){this.pc&&this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}),b,e)};d.test=function(){if("object"===typeof navigator){if(navigator.webkitGetUserMedia&&"function"===typeof window.webkitRTCPeerConnection)return!0;if(navigator.mozGetUserMedia&&"function"===typeof window.mozRTCPeerConnection){try{if("function"!==typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(c){return!1}return!0}if("undefined"!==typeof RTCIceGatherer)return!0}return!1};
a.protocol=d.test()?new d:null;a.enabled=!!a.protocol;n.exports=a},{"../log":8,"../statemachine":22,"../util":23,"ortc-adapter":26}],17:[function(l,n,k){function a(a){var d=[];a.result().forEach(function(a){var f=null;switch(a.type){case "googCandidatePair":a:{var f={},e=a.names();f.timestamp=a.timestamp?Number(a.timestamp):null;for(var h=0;h<e.length;h++){var q=e[h],c=a.stat(q);switch(q){case "googActiveConnection":if("true"!==c){f=null;break a}break;case "googLocalAddress":f.localAddress=c;break;
case "googRemoteAddress":f.remoteAddress=c;break;case "googRtt":f.rtt=Number(c)}}}break;case "ssrc":f=g(a)}f&&d.push(f)});return d.reduceRight(m,{})}function g(a){var d={},h=a.names();d.timestamp=a.timestamp?Number(a.timestamp):null;h.forEach(function(f){var e=a.stat(f);switch(f){case "googCodecName":""!==e&&(d.codecName=e);break;case "googJitterBufferMs":f=Number(e);-1!==f&&(d.jitterBufferMs=f);break;case "googJitterReceived":f=Number(e);-1!==f&&(d.jitter=f);break;case "bytesReceived":case "bytesSent":case "packetsReceived":case "packetsSent":case "timestamp":case "audioInputLevel":case "audioOutputLevel":d[f]=
Number(e);break;case "packetsLost":e=Number(e),-1!==e&&(d[f]=e)}});return d}function h(a){var d=[];a.forEach(function(a){var f=null;switch(a.type){case "inboundrtp":var e={},h;for(h in a)switch(f=a[h],h){case "mozRtt":e.rtt=f;break;case "timestamp":e.timestamp=f?Number(f):null;break;case "jitter":e[h]=1E3*f;break;case "bytesReceived":case "packetsLost":case "packetsReceived":e[h]=f}f=e;break;case "outboundrtp":if(!1===a.isRemote){h={};for(e in a)switch(f=a[e],e){case "timestamp":h[e]=f?Number(f):
null;break;case "bytesSent":case "packetsSent":h[e]=f}f=h}}f&&d.push(f)});return d.reduceRight(m,{})}function m(a,f){for(var d in f)a[d]=f[d];return a}n.exports=function(d,f){function m(){return(new Promise(function(a,f){d.getStats(a,f)})).then(f.withChromeStats)}function g(){return(new Promise(function(a,f){d.getStats(null,a,f)})).then(f.withFirefoxStats)}return new Promise(function(e,t){f=f||{};f.navigator=f.navigator||navigator;f.withChromeStats=f.withChromeStats||a;f.withFirefoxStats=f.withFirefoxStats||
h;return d?"object"!==typeof f.navigator||"function"!==typeof d.getStats?t(Error("WebRTC statistics are unsupported")):f.navigator.webkitGetUserMedia?e(m()):f.navigator.mozGetUserMedia?e(g()):t(Error("WebRTC statistics are unsupported")):t(Error("PeerConnection is null"))})}},{}],18:[function(l,n,k){function a(){Object.defineProperties(this,{_eventEmitter:{value:new g},_handlers:{value:{}}})}var g=l("events").EventEmitter;a.prototype.dispatchEvent=function(a){return this._eventEmitter.emit(a.type,
a)};a.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)};a.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)};a.prototype._defineEventHandler=function(a){var h=this;Object.defineProperty(this,"on"+a,{get:function(){return h._handlers[a]},set:function(d){var f=h._handlers[a];!f||"function"!==typeof d&&"undefined"!==typeof d&&null!==d||(h._handlers[a]=null,h.removeEventListener(a,
f));"function"===typeof d&&(h._handlers[a]=d,h.addEventListener(a,d))}})};n.exports=a},{events:25}],19:[function(l,n,k){n.exports=function(a){Object.defineProperties(this,{deviceId:{get:function(){return a.deviceId}},groupId:{get:function(){return a.groupId}},kind:{get:function(){return a.kind}},label:{get:function(){return a.label}}})}},{}],20:[function(l,n,k){function a(){v.call(this);this._defineEventHandler("devicechange");this._defineEventHandler("deviceinfochange");var a=[];Object.defineProperties(this,
{_deviceChangeIsNative:{value:f(this,"devicechange")},_deviceInfoChangeIsNative:{value:f(this,"deviceinfochange")},_knownDevices:{value:a},_pollInterval:{value:null,writable:!0}});navigator.mediaDevices.enumerateDevices().then(function(e){e.sort(w).forEach([].push,a)});this._eventEmitter.on("newListener",function(a){if("devicechange"===a||"deviceinfochange"===a)this._pollInterval=this._pollInterval||setInterval(m.bind(null,this),500)}.bind(this));this._eventEmitter.on("removeListener",function(){this._pollInterval&&
!h(this)&&(clearInterval(this._pollInterval),this._pollInterval=null)}.bind(this))}function g(a,e){var c=e.reduce(function(a,c){return a.set(c.deviceId,c.label||null)},new Map);return a.some(function(a){var b=c.get(a.deviceId);return"undefined"!==typeof b&&b!==a.label})}function h(a){return 0<["devicechange","deviceinfochange"].reduce(function(e,c){return e+a._eventEmitter.listenerCount(c)},0)}function m(a){navigator.mediaDevices.enumerateDevices().then(function(e){var c=a._knownDevices,b=c.slice();
[].splice.apply(c,[0,c.length].concat(e.sort(w)));a._deviceChangeIsNative||c.length===b.length&&!d("deviceId",c,b)||a.dispatchEvent(new Event("devicechange"));!a._deviceInfoChangeIsNative&&g(c,b)&&a.dispatchEvent(new Event("deviceinfochange"))})}function d(a,e,c){return e.some(function(b,e){return b[a]!==c[e][a]})}function f(a,d){return"on"+d in e?(e.addEventListener(d,function(c){a.dispatchEvent(c)}),!0):!1}function w(a,e){return a.deviceId<e.deviceId}var v=l("./eventtarget");l=l("util").inherits;
var e="undefined"!==typeof navigator&&navigator.mediaDevices;l(a,v);a.prototype.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices.apply(navigator.mediaDevices,arguments)};a.prototype.getUserMedia=function(){return navigator.mediaDevices.getUserMedia.apply(navigator.mediaDevices,arguments)};n.exports=e?new a:null},{"./eventtarget":18,util:40}],21:[function(l,n,k){function a(h,g,d){if(!(this instanceof a))return new a(h,g,d);if(!h||!g)throw Error("name and url are required arguments");
d=Object.assign({maxDuration:0,minDuration:0,shouldLoop:!1},d);Object.defineProperties(this,{_activeEls:{value:new Set},_isPlaying:{value:!1,writable:!0},_isSinkSupported:{value:!(!HTMLAudioElement||!HTMLAudioElement.prototype.setSinkId)},_maxDuration:{value:d.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_minDuration:{value:d.minDuration},_minDurationTimeout:{value:null,writable:!0},_shouldLoop:{value:d.shouldLoop},_sinkIds:{value:[]},_timeStarted:{value:null,writable:!0},name:{enumerable:!0,
value:h},url:{enumerable:!0,value:g}});this._isSinkSupported||this._sinkIds.splice(0,this._sinkIds.length,"default");h=new Audio([g]);h.preload="auto";h.muted=!0;h.play()}function g(a){a._activeEls.forEach(function(a){a.pause();a.src="";a.load()});a._activeEls.clear();clearTimeout(a._minDurationTimeout);clearTimeout(a._maxDurationTimeout);a._isPlaying=!1;a._minDurationTimeout=null;a._maxDurationTimeout=null;a._shouldStop=!1;a._timeStarted=null}a.prototype.setSinkIds=function(a){this._isSinkSupported&&
(a=a.forEach?a:[a],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(a)))};a.prototype.stop=function(){if(this._isPlaying){if(this._minDuration&&(!this._timeStarted||Date.now()-this._timeStarted<this._minDuration))return this._shouldStop=!0,!1;g(this)}return!0};a.prototype.play=function(){if(!this.stop())return Promise.resolve();0<this._maxDuration&&(this._maxDurationTimeout=setTimeout(g.bind(null,this),this._maxDuration));var a=this;this._isPlaying=!0;0<this._minDuration&&(this._minDurationTimeout=
setTimeout(function(){a._shouldStop&&g(a)},this._minDuration));return Promise.all(this._sinkIds.map(function(g){var d=new Audio([a.url]);d.loop=a._shouldLoop;d.addEventListener("ended",function(){a._activeEls["delete"](d)});return a._isSinkSupported?(new Promise(function(a){d.addEventListener("canplaythrough",a)})).then(function(){return d.setSinkId(g)}).then(function(){a._activeEls.add(d);return d.play()}).then(function(){return d}):(a._activeEls.add(d),d.play())})).then(function(g){a._timeStarted=
Date.now();return g})};n.exports=a},{}],22:[function(l,n,k){function a(g,d){if(!(this instanceof a))return new a(g,d);var f=d;Object.defineProperties(this,{_currentState:{get:function(){return f},set:function(a){f=a}},currentState:{enumerable:!0,get:function(){return f}},states:{enumerable:!0,value:g},transitions:{enumerable:!0,value:[]}});Object.freeze(this)}function g(a,d){Object.defineProperties(this,{from:{enumerable:!0,value:a},to:{enumerable:!0,value:d}})}function h(a,d){if(!(this instanceof
h))return new h(a,d);Error.call(this);g.call(this,a,d);Object.defineProperties(this,{message:{enumerable:!0,value:"Invalid transition from "+("string"===typeof a?'"'+a+'"':"null")+' to "'+d+'"'}});Object.freeze(this)}l=l("util").inherits;a.prototype.transition=function(a){var d=this.currentState,f=this.states[d],d=f&&-1!==f.indexOf(a)?new g(d,a):new h(d,a);this.transitions.push(d);this._currentState=a;if(d instanceof h)throw d;return this};l(h,Error);n.exports=a},{util:40}],23:[function(l,n,k){function a(b){if(!(this instanceof
a))return new a(b);this.message=b}function g(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};a.memo[b]||(a.memo[b]=a.apply(null,b));return a.memo[b]}}function h(b){b=b.split(".");if(3!==b.length)throw new a("Wrong number of segments");return q(b[1])}function m(a){if(""===a)return{};if(-1===a.indexOf("&")&&-1===a.indexOf("="))return a;a=a.split("&");for(var b={},c=0;c<a.length;c++){var e=a[c].split("=");b[decodeURIComponent(e[0])]=m(decodeURIComponent(e[1]))}return b}
function d(a){try{return btoa(a)}catch(r){return(new Buffer(a)).toString("base64")}}function f(a){try{return atob(a)}catch(r){try{return(new Buffer(a,"base64")).toString("ascii")}catch(p){return base64.decode(a)}}}function w(a,c){return a===c?!0:typeof a!==typeof c?!1:a instanceof Date&&c instanceof Date?a.getTime()===c.getTime():"object"!==typeof a&&"object"!==typeof c?a===c:v(a,c)}function v(a,e){if("undefined"===typeof a||null===a||"undefined"===typeof e||null===e||a.prototype!==e.prototype)return!1;
try{var b=c(a),d=c(e)}catch(B){return!1}if(b.length!==d.length)return!1;b.sort();d.sort();for(d=b.length-1;0<=d;d--){var f=b[d];if(!w(a[f],e[f]))return!1}return!0}function e(a){var b=[],c;for(c in a){var d="object"===typeof a[c]?e(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}}var t=l("events").EventEmitter;a.prototype.toString=function(){return"Twilio.Exception: "+this.message};var q=g(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,
"/");a=f(a);return JSON.parse(a)});l=g(function(b){b=h(b);for(var c=0===b.scope.length?[]:b.scope.split(" "),e={},d=0;d<c.length;d++){var f;f=c[d].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!f||4!==f.length)throw new a("Bad scope URI");f={service:f[1],privilege:f[2],params:m(f[3])};e[f.service+":"+f.privilege]=f}b.scope=e;return b});var c="function"===typeof Object.keys?Object.keys:function(a){var b=[],c;for(c in a)b.push(c);return b};k.getPStreamVersion=function(){return"1.3"};k.getReleaseVersion=function(){return"1.4.14"};
k.getSoundVersion=function(){return"1.0.0"};k.dummyToken=function(a){var b={iss:"AC1111111111111111111111111111111",exp:14E8},c;for(c in b)a[c]=a[c]||b[c];a=d(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};k.Exception=a;k.decode=h;k.btoa=d;k.atob=f;k.objectize=l;k.urlencode=function(a,c){var b=[],e;c=c||!1;for(var d in a)if(c&&a[d]instanceof Array)for(var f in a[d])e=a[d][f],b.push(encodeURIComponent(d)+"="+encodeURIComponent(e));else e=
a[d],b.push(encodeURIComponent(d)+"="+encodeURIComponent(e));return b.join("&")};k.encodescope=function(a,c,d){a=["scope",a,c].join(":");c=!0;for(var b in d){void 0;c=!1;break}return c?a:a+"?"+e(d)};k.Set=Set;k.bind=function(a,c){var b=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return a.apply(c,b.concat(e))}};k.getSystemInfo=function(){var a="undefined"!==typeof navigator?navigator:{};return{p:"browser",v:"1.3",h:"a398e13",browser:{userAgent:a.userAgent||
"unknown",platform:a.platform||"unknown"},plugin:"rtc"}};k.splitObjects=function(a){a="string"!==typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0===a.length?[]:a.split("\n")};k.generateConnectionUUID=function(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})};k.getTwilioRoot=function(){return"https://media.twiliocdn.com/sdk/js/client/"};k.monitorEventEmitter=function(a,c){function b(e){var d=
t.listenerCount(c,e);e="The number of "+e+" listeners on "+a+" exceeds the recommended number of 10. While twilio.js will continue to function normally, this may be indicative of an application error. Note that "+e+" listeners exist for the lifetime of the "+a+".";10<=d&&("undefined"!==typeof console&&(console.warn?console.warn(e):console.log&&console.log(e)),c.removeListener("newListener",b))}c.setMaxListeners(0);c.on("newListener",b)};k.deepEqual=w;k.average=function(a){return a.reduce(function(a,
b){return a+b})/a.length};k.difference=function(a,c,e){e=e||function(a){return a};var b=new Set(c.map(e));return a.filter(function(a){return!b.has(e(a))})};k.isFirefox=function(a){a=a||("undefined"===typeof window?global.navigator:window.navigator);return"string"===typeof a.userAgent&&/firefox|fxios/i.test(a.userAgent)};k.isEdge=function(a){a=a||("undefined"===typeof window?global.navigator:window.navigator);return"string"===typeof a.userAgent&&/edge\/\d+/i.test(a.userAgent)}},{events:25}],24:[function(l,
n,k){function a(){}function g(d){if(!(this instanceof g))return new g(d);this.sock=null;this.onerror=this.onmessage=this.onclose=this.onopen=a;var f={logPrefix:"[WSTransport]",chunderw:"chunderw-vpc-gll.twilio.com",reconnect:!0,debug:!1,secureSignaling:!0};d=d||{};for(var h in f)h in d||(d[h]=f[h]);this.options=d;m.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.defaultReconnect=this.options.reconnect;this.uri=(this.options.secureSignaling?"wss://":"ws://")+this.options.host+
"/signal";return this}var h=l("./heartbeat").Heartbeat,m=l("./log"),d=l("ws");g.prototype.msgQueue=[];g.prototype.open=function(a){this.log("Opening socket");this.sock&&2>this.sock.readyState?this.log("Socket already open."):(this.options.reconnect=this.defaultReconnect,this.heartbeat&&(this.heartbeat.onsleep=function(){}),this.heartbeat=new h({interval:15}),this.sock=this._connect(a))};g.prototype.send=function(a){if(this.sock)if(0===this.sock.readyState)this.msgQueue.push(a);else try{this.sock.send(a)}catch(w){this.log("Error while sending. Closing socket: "+
w.message),this.sock.close()}};g.prototype.close=function(){this.log("Closing socket");this.options.reconnect=!1;this.sock&&(this.sock.close(),this.sock=null);this.heartbeat.onsleep=function(){}};g.prototype._cleanupSocket=function(d){d&&(this.log("Cleaning up socket"),d.onopen=function(){d.close()},d.onmessage=a,d.onerror=a,d.onclose=a,2>d.readyState&&d.close())};g.prototype._connect=function(a){var f=++a||1;this.log("attempting to connect");var g=null;try{g=new d(this.uri)}catch(b){return this.onerror({code:31E3,
message:b.message||"Could not connect to "+this.uri}),this.close(),null}var e=this,h=this.sock,q=null,c=setTimeout(function(){e.log("connection attempt timed out");g.onclose=function(){};g.close();e.onclose();e._tryReconnect(f)},5E3);g.onopen=function(){clearTimeout(c);e._cleanupSocket(h);q=(new Date).getTime();e.log("Socket opened");e.heartbeat.onsleep=function(){e.log("Heartbeat timed out. closing socket");e.sock.onclose=function(){};e.sock.close();e.onclose();e._tryReconnect(f)};e.heartbeat.beat();
e.onopen();for(var a=0;a<e.msgQueue.length;a++)e.sock.send(e.msgQueue[a]);e.msgQueue=[]};g.onclose=function(){clearTimeout(c);e._cleanupSocket(h);e.heartbeat.onsleep=function(){};q&&10<((new Date).getTime()-q)/1E3&&(f=1);e.log("Socket closed");e.onclose();e._tryReconnect(f)};g.onerror=function(a){e.log("Socket received error: "+a.message);e.onerror({code:31E3,message:a.message||"WSTransport socket error"})};g.onmessage=function(a){e.heartbeat.beat();if("\n"===a.data)e.send("\n");else e.onmessage(a)};
return g};g.prototype._tryReconnect=function(a){a=a||0;if(this.options.reconnect){this.log("Attempting to reconnect.");var d=this,f=0,f=5>a?30+Math.round(50*Math.random()*Math.pow(2,a)):3E3;setTimeout(function(){d.open(a)},f)}};k.WSTransport=g},{"./heartbeat":7,"./log":8,ws:41}],25:[function(l,n,k){function a(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function g(a){return"function"===typeof a}function h(a){return"object"===typeof a&&null!==a}n.exports=a;a.EventEmitter=
a;a.prototype._events=void 0;a.prototype._maxListeners=void 0;a.defaultMaxListeners=10;a.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};a.prototype.emit=function(a){var d,f,m,k;this._events||(this._events={});if("error"===a&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){d=arguments[1];if(d instanceof Error)throw d;f=Error('Uncaught, unspecified "error" event. ('+
d+")");f.context=d;throw f;}f=this._events[a];if(void 0===f)return!1;if(g(f))switch(arguments.length){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:d=Array.prototype.slice.call(arguments,1),f.apply(this,d)}else if(h(f))for(d=Array.prototype.slice.call(arguments,1),k=f.slice(),f=k.length,m=0;m<f;m++)k[m].apply(this,d);return!0};a.prototype.addListener=function(m,d){var f;if(!g(d))throw TypeError("listener must be a function");
this._events||(this._events={});this._events.newListener&&this.emit("newListener",m,g(d.listener)?d.listener:d);this._events[m]?h(this._events[m])?this._events[m].push(d):this._events[m]=[this._events[m],d]:this._events[m]=d;h(this._events[m])&&!this._events[m].warned&&(f=void 0!==this._maxListeners?this._maxListeners:a.defaultMaxListeners)&&0<f&&this._events[m].length>f&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[m].length),"function"===typeof console.trace&&console.trace());return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(a,d){function f(){this.removeListener(a,f);h||(h=!0,d.apply(this,arguments))}if(!g(d))throw TypeError("listener must be a function");var h=!1;f.listener=d;this.on(a,f);return this};a.prototype.removeListener=function(a,d){var f,k,m;if(!g(d))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;f=this._events[a];
m=f.length;k=-1;if(f===d||g(f.listener)&&f.listener===d)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,d);else if(h(f)){for(;0<m--;)if(f[m]===d||f[m].listener&&f[m].listener===d){k=m;break}if(0>k)return this;1===f.length?(f.length=0,delete this._events[a]):f.splice(k,1);this._events.removeListener&&this.emit("removeListener",a,d)}return this};a.prototype.removeAllListeners=function(a){var d;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?
this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(d in this._events)"removeListener"!==d&&this.removeAllListeners(d);this.removeAllListeners("removeListener");this._events={};return this}d=this._events[a];if(g(d))this.removeListener(a,d);else if(d)for(;d.length;)this.removeListener(a,d[d.length-1]);delete this._events[a];return this};a.prototype.listeners=function(a){return this._events&&this._events[a]?g(this._events[a])?[this._events[a]]:this._events[a].slice():
[]};a.prototype.listenerCount=function(a){if(this._events){a=this._events[a];if(g(a))return 1;if(a)return a.length}return 0};a.listenerCount=function(a,d){return a.listenerCount(d)}},{}],26:[function(l,n,k){n.exports.RTCIceCandidate=l("./rtcicecandidate");n.exports.RTCPeerConnection=l("./rtcpeerconnection");n.exports.RTCSessionDescription=l("./rtcsessiondescription")},{"./rtcicecandidate":29,"./rtcpeerconnection":30,"./rtcsessiondescription":32}],27:[function(l,n,k){function a(g,h,k,d,f,l,n,e,t,q){if(!(this instanceof
a))return new a(g,h,k,d,f,l,n,e,t,q);var c=!1;g=g||"0.0.0.0";n="number"===typeof n?n:9;e="boolean"===typeof e?e:!0;t=t||null;q=q||null;Object.defineProperties(this,{_address:{get:function(){return g},set:function(a){g=a}},_candidates:{value:[]},_port:{get:function(){return n},set:function(a){n=a}},_rejected:{get:function(){return c},set:function(a){c=a}},_streamId:{get:function(){return t},set:function(a){t=a}},_track:{get:function(){return q},set:function(a){q=a}},_triples:{value:new Set},candidates:{enumerable:!0,
get:function(){return this._candidates.slice()}},capabilities:{enumerable:!0,value:k},defaultCandidate:{enumerable:!0,get:function(){return this._candidates.length?this._candidates[0]:null}},direction:{enumerable:!0,value:d},kind:{enumerable:!0,value:f},port:{enumerable:!0,get:function(){return n}},rtcpMux:{enumerable:!0,value:e},streamId:{enumerable:!0,get:function(){return t}},track:{enumerable:!0,get:function(){return q}}});h&&h.forEach(this.addCandidate,this)}a.prototype.addCandidate=function(a){var g=
[a.ip,a.port,a.protocol].join(" ");return this._triples.has(g)?!1:(this._triples.add(g),this._candidates.push(a),!0)};a.prototype.copy=function(g,h,k,d,f,l,n){return new a(this.address,h,k||this.capabilities,d||this.direction,this.kind,this.mid,f,this.rtcpMux,l,n)};a.prototype.copyAndReject=function(){return(new a(null,this.candidates,this.capabilities,this.direction,this.kind,this.mid,null,this.rtcpMux)).reject()};a.prototype.reject=function(){this.setPort(0);return this};a.prototype.setAddress=
function(a){this._address=a;return this};a.prototype.setPort=function(a){this._port=a;return this};n.exports=a},{}],28:[function(l,n,k){function a(g,h){if(!(this instanceof a))return new a(g,h);Event.call(this,g,h);Object.defineProperties(this,{stream:{enumerable:!0,value:h.stream}})}n.exports=a},{}],29:[function(l,n,k){function a(g){if(!(this instanceof a))return new a(g);Object.defineProperties(this,{candidate:{enumerable:!0,value:g.candidate},sdpMLineIndex:{enumerable:!0,value:g.sdpMLineIndex}})}
n.exports=a},{}],30:[function(l,n,k){function a(e){if(!(this instanceof a))return new a(e);e={gatherPolicy:e.gatherPolicy||"all",iceServers:[]};var c=new RTCIceGatherer(e),b=!1;c.onlocalcandidate=this._onlocalcandidate.bind(this);var d=null,f=!1,q=0,g=new RTCIceTransport,h=null;g.onicestatechange=this._onicestatechange.bind(this);var k=new RTCDtlsTransport(g);k.ondtlsstatechange=this._ondtlsstatechange.bind(this);var l="stable",t=null,m=null,n=null,v=null;Object.defineProperties(this,{_dtlsTransport:{value:k},
_dtmfSenders:{value:new Map},_gatherOptions:{value:e},_iceCandidatesAdded:{get:function(){return q},set:function(a){q=a}},_iceGatherer:{value:c},_iceGatheringCompleted:{get:function(){return b},set:function(a){b=a}},_iceTransport:{value:g},_localCandidates:{value:new Set},_localDescription:{get:function(){return m},set:function(a){m=a}},_localStreams:{value:new Set},_midCounters:{value:{audio:0,video:0}},_remoteCandidates:{value:new Set},_remoteDescription:{get:function(){return n},set:function(a){n=
a}},_remoteStreams:{value:[]},_rtpReceivers:{value:new Map},_rtpSenders:{value:new Map},_signalingState:{get:function(){return l},set:function(a){l=a;if(this.onsignalingstatechange)this.onsignalingstatechange()}},_streamIds:{value:new Map},iceConnectionState:{enumerable:!0,get:function(){return g.state}},iceGatheringState:{enumerable:!0,get:function(){return b?"gathering":"complete"}},localDescription:{enumerable:!0,get:function(){return m}},onaddstream:{enumerable:!0,get:function(){return v},set:function(a){v=
a}},onicecandidate:{enumerable:!0,get:function(){return d},set:function(a){d=a;if(!f)try{c.getLocalCandidates().forEach(c.onlocalcandidate)}catch(x){}f=!0}},oniceconnectionstatechange:{enumerable:!0,get:function(){return h},set:function(a){h=a}},onsignalingstatechange:{enumerable:!0,get:function(){return t},set:function(a){t=a}},remoteDescription:{enumerable:!0,get:function(){return n}},signalingState:{enumerable:!0,get:function(){return l}}})}function g(a){return Error("Invalid signaling state: "+
a)}function h(a,c){var b=[];a.forEach(function(a){c.forEach(function(c){a.name===c.name&&a.clockRate===c.clockRate&&a.numChannels===c.numChannels&&b.push(c)})});return b}var m=l("./mediasection"),d=l("./mediastreamevent"),f=l("./rtcicecandidate"),w=l("./rtcpeerconnectioniceevent"),v=l("./rtcsessiondescription"),e=l("sdp-transform"),t=l("./sdp-utils");a.prototype._makeMid=function(a){return a+ ++this._midCounters[a]};a.prototype._ondtlsstatechange=function(a){void 0};a.prototype._onicestatechange=
function(a){if(this.oniceconnectionstatechange)this.oniceconnectionstatechange(a)};a.prototype._onlocalcandidate=function(a){Object.keys(a.candidate).length||(this._iceGatheringCompleted=!0);this._localCandidates.add(a.candidate);if(this.onicecandidate){a=a.candidate;if(Object.keys(a).length){var c=["a=candidate",a.foundation,1,a.protocol,a.priority,a.ip,a.port,a.type];a.relatedAddress&&(c=c.concat(["raddr",a.relatedAddress,"rport",a.relatedPort]));c.push("generation 0");a=new f({candidate:c.join(" "),
sdpMLineIndex:0})}else a=null;this.onicecandidate(new w("icecandidate",{candidate:a}))}};a.prototype._sendRtp=function(a){var c=a.kind;this._rtpSenders.forEach(function(b){b.track.kind===c&&b.send(a.capabilities)},this);return this};a.prototype._sendAndReceiveRtp=function(a){a.forEach(function(a){"sendrecv"!==a.direction&&"sendonly"!==a.direction||this._sendRtp(a);"sendrecv"!==a.direction&&"recvonly"!==a.direction||this._receiveRtp(a)},this);return this};a.prototype._receiveRtp=function(a){var c=
new RTCRtpReceiver(this._dtlsTransport,a.capabilities.type);c.receive(a.capabilities);a=c.track;this._rtpReceivers.set(a,c);c=new MediaStream;c.addTrack(a);this._remoteStreams.push(c);if(this.onaddstream)this.onaddstream(new d("addstream",{stream:c}));return this};a.prototype._startDtlsTransport=function(a){this._dtlsTransport.start(a);return this};a.prototype._startIceTransport=function(a){this._iceTransport.start(this._iceGatherer,a,"have-local-offer"===this.signalingState?"controlling":"controlled");
return this};a.prototype.addIceCandidate=function(a,c,b){void 0;this._iceCandidatesAdded++;a?(b=a.candidate.indexOf("candidate:"),a=a.candidate.slice(b+10).replace(/ +/g," ").split(" "),b={foundation:a[0],protocol:a[2],priority:parseInt(a[3]),ip:a[4],port:parseInt(a[5]),type:a[7],relatedAddress:null,relatedPort:0,tcpType:"active"},"host"!==b.type&&(b.relatedAddress=a[9],b.relatedPort=parseInt(a[11])),a=b):a={};b=[a.ip,a.port,a.transport].join(" ");this._remoteCandidates.has(b)||(this._remoteCandidates.add(b),
this._iceTransport.addRemoteCandidate(a));c&&c()};a.prototype.addStream=function(a){this._localStreams.add(a);a.getTracks().forEach(function(c){var b=new RTCRtpSender(c,this._dtlsTransport);this._rtpSenders.set(c,b);this._streamIds.set(c,a.id)},this)};a.prototype.close=function(){this._signalingState="closed";this._rtpReceivers.forEach(function(a){a.stop()});this._dtlsTransport.stop();this._iceTransport.stop()};a.prototype.createAnswer=function(a,c){if("have-remote-offer"!==this.signalingState)return void c(g(this.signalingState));
var b=t.parseDescription(this.remoteDescription),d={audio:[],video:[]};this.getLocalStreams().forEach(function(a){d.audio=d.audio.concat(a.getAudioTracks());d.video=d.video.concat(a.getVideoTracks())});b=b.mediaSections.map(function(a){var b=a.kind,c=a.direction,e=a.capabilities,f=RTCRtpSender.getCapabilities(b),f=h(e.codecs,f.codecs),e={codecs:f},g;if(!f.length)return a.copyAndReject();"inactive"===c||"recvonly"===c&&!d[b].length?b="inactive":"recvonly"===c?(g=d[b].shift(),b="sendonly"):b="sendrecv"===
c?(g=d[b].shift())?"sendrecv":"recvonly":"recvonly";c=this._streamIds.get(g);return a.copy(null,null,e,b,null,c,g)},this);b.forEach(function(a){this._localCandidates.forEach(a.addCandidate,a)},this);var f=t.makeInitialSDPBlob();t.addMediaSectionsToSDPBlob(f,b);t.addIceParametersToSDPBlob(f,this._iceGatherer.getLocalParameters());t.addDtlsParametersToSDPBlob(f,this._dtlsTransport.getLocalParameters());b=new v({sdp:e.write(f),type:"answer"});a(b)};a.prototype.createDTMFSender=function(a){if(!this._dtmfSenders.has(a)){var c=
this._rtpSenders.get(a),c=new RTCDtmfSender(c);this._dtmfSenders.set(a,c)}return this._dtmfSenders.get(a)};a.prototype.createOffer=function(a,c,b){var d={audio:null,video:null},f={audio:0,video:0};b=b||{};["optional","mandatory"].forEach(function(a){a in b&&("OfferToReceiveAudio"in b[a]&&(d.audio=Number(b[a].OfferToReceiveAudio)),"OfferToReceiveVideo"in b[a]&&(d.video=Number(b[a].OfferToReceiveVideo)))});var g=[],h={audio:d.audio,video:d.video};this.getLocalStreams().forEach(function(a){var b=a.getAudioTracks(),
c=a.getVideoTracks();f.audio+=b.length;f.video+=c.length;b.concat(c).forEach(function(b){var c=b.kind,e=RTCRtpSender.getCapabilities(c),d,f=this._makeMid(c);null===h.audio?d="sendrecv":h[c]?(h[c]--,d="sendrecv"):d="sendonly";b=new m(null,null,e,d,c,f,null,null,a.id,b);g.push(b)},this)},this);["audio","video"].forEach(function(a){var b=Math.max(d[a]-f[a],0);if(b)for(var c=RTCRtpSender.getCapabilities(a),e;b--;)e=this._makeMid(a),e=new m(null,null,c,"recvonly",a,e),g.push(e)},this);g.forEach(function(a){this._localCandidates.forEach(a.addCandidate,
a)},this);c=t.makeInitialSDPBlob();t.addMediaSectionsToSDPBlob(c,g);t.addIceParametersToSDPBlob(c,this._iceGatherer.getLocalParameters());t.addDtlsParametersToSDPBlob(c,this._dtlsTransport.getLocalParameters());c=new v({sdp:e.write(c),type:"offer"});a(c)};a.prototype.getLocalStreams=function(){return Array.from(this._localStreams)};a.prototype.getRemoteStreams=function(){return this._remoteStreams.slice()};a.prototype.removeStream=function(a){this._localStreams["delete"](a);a.getTracks().forEach(function(a){this._rtpSenders.get(a).stop();
this._rtpSenders["delete"](a);this._streamIds["delete"](a)},this)};a.prototype.setLocalDescription=function(a,c,b){switch(this.signalingState){case "stable":b="have-local-offer";break;case "have-remote-offer":b="stable";break;default:return void b(g(this.signalingState))}var e=t.parseDescription(a);if("have-remote-offer"===this.signalingState){e.mediaSections.forEach(this._sendRtp,this);var d=t.parseDescription(this.remoteDescription).mediaSections[0].capabilities.encodings[0].ssrc;e.mediaSections.forEach(function(a){a.capabilities.encodings.forEach(function(a){a.ssrc=
d});a.capabilities.rtcp.ssrc=d});e.mediaSections.forEach(this._receiveRtp,this)}this._localDescription=a;this._signalingState=b;c()};a.prototype.setRemoteDescription=function(a,c,b){switch(this.signalingState){case "stable":b="have-remote-offer";break;case "have-local-offer":b="stable";break;default:return void b(g(this.signalingState))}var e=t.parseDescription(a);"closed"!==this._iceTransport.state&&"completed"!==this._iceTransport.state&&(e.mediaSections.forEach(function(a){a.candidates.forEach(this._iceTransport.addRemoteCandidate,
this._iceTransport)},this),this._startIceTransport(e.iceParameters[0]),this._startDtlsTransport(e.dtlsParameters[0]));"have-local-offer"===this.signalingState&&(e.mediaSections.forEach(this._receiveRtp,this),e.mediaSections.forEach(this._sendRtp,this));this._remoteDescription=a;this._signalingState=b;c()};n.exports=a},{"./mediasection":27,"./mediastreamevent":28,"./rtcicecandidate":29,"./rtcpeerconnectioniceevent":31,"./rtcsessiondescription":32,"./sdp-utils":33,"sdp-transform":35}],31:[function(l,
n,k){function a(g,h){if(!(this instanceof a))return new a(g,h);Event.call(this,g,h);Object.defineProperties(this,{candidate:{enumerable:!0,value:h.candidate}})}n.exports=a},{}],32:[function(l,n,k){function a(g){if(!(this instanceof a))return new a(g);Object.defineProperties(this,{sdp:{enumerable:!0,value:g.sdp},type:{enumerable:!0,value:g.type}})}n.exports=a},{}],33:[function(l,n,k){function a(a,d,f){a=a||{};a.candidates=a.candidates||[];if(!d)return a;d.forEach(function(c){if(c.foundation){var b=
{foundation:c.foundation,transport:c.protocol,priority:c.priority,ip:c.ip,port:c.port,type:c.type,generation:0};c.relatedAddress&&(b.raddr=c.relatedAddress,b.rport=c.relatedPort);if("number"===typeof f)b.component=f,a.candidates.push(b);else{b.component=1;a.candidates.push(b);c={};for(var e in b)c[e]=b[e];c.component=2;a.candidates.push(c)}}else a.endOfCandidates="end-of-candidates"});return a}function g(e,d,f){e=e||{};if(!e.media)return e;e.media.forEach(function(c){a(c,d,f)});return e}function h(a,
d){a=a||{};if(!a.media)return a;a.media.forEach(function(a){a=a||{};var c=d.fingerprints;c.length&&(a.fingerprint={type:c[0].algorithm,hash:c[0].value})});return a}function m(a,d){a=a||{};if(!a.media)return a;a.media.forEach(function(a){a=a||{};a.iceUfrag=d.usernameFragment;a.icePwd=d.password});return a}function d(e,d){var g=d.streamId;g&&(e.msidSemantic=e.msidSemantic||{semantic:"WMS",token:[]},e.msidSemantic.token.push(g));var c=d.mid;if(c){e.groups=e.groups||[];var b=!1;e.groups.forEach(function(a){"BUNDLE"===
a.type&&(a.mids.push(c),b=!0)});b||e.groups.push({type:"BUNDLE",mids:[c]})}var h=[],k=[],l=[];d.capabilities.codecs.forEach(function(a){var b=a.preferredPayloadType;h.push(b);var c={payload:b,codec:a.name,rate:a.clockRate};1<a.numChannels&&(c.encoding=a.numChannels);k.push(c);switch(a.name){case "telephone-event":a.parameters&&a.parameters.events&&l.push({payload:b,config:a.parameters.events})}});var m=[];if(g&&d.track)var g=Math.floor(4294967296*Math.random()),n=f(),t=d.track.id,m=m.concat([{id:g,
attribute:"cname",value:n},{id:g,attribute:"msid",value:d.streamId+" "+t},{id:g,attribute:"mslabel",value:t},{id:g,attribute:"label",value:t}]);g=d.defaultCandidate;m={rtp:k,fmtp:l,type:d.kind,port:g?g.port:9,payloads:h.join(" "),protocol:"RTP/SAVPF",direction:d.direction,connection:{version:4,ip:g?g.ip:"0.0.0.0"},rtcp:{port:g?g.port:9,netType:"IN",ipVer:4,address:g?g.ip:"0.0.0.0"},ssrcs:m};c&&(m.mid=c);d.rtcpMux&&(m.rtcpMux="rtcp-mux");a(m,d.candidates);e.media.push(m);return e}function f(){for(var a=
"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/".split(""),d=16,f="";d--;)f+=a[Math.floor(Math.random()*a.length)];return f}var w=l("./mediasection"),v=l("sdp-transform");n.exports.addCandidatesToSDPBlob=function(a,d,f){a=a||{};g(a,d,f);return a};n.exports.addDtlsParametersToSDPBlob=function(a,d){a=a||{};h(a,d);return a};n.exports.addIceParametersToSDPBlob=function(a,d){a=a||{};m(a,d);return a};n.exports.addMediaSectionsToSDPBlob=function(a,f){f.forEach(d.bind(null,a));return a};
n.exports.makeInitialSDPBlob=function(a){a=a||Math.floor(4294967296*Math.random());return{version:0,origin:{username:"-",sessionId:a,sessionVersion:0,netType:"IN",ipVer:4,address:"127.0.0.1"},name:"-",timing:{start:0,stop:0},connection:{version:4,ip:"0.0.0.0"},media:[]}};n.exports.parseDescription=function(a){a=v.parse(a.sdp);var d=[],e=[],c=[],b=[],f=[a];a.media&&(f=f.concat(a.media));f.forEach(function(a){a.iceUfrag&&a.icePwd&&a.fingerprint&&(d.push({usernameFragment:a.iceUfrag,password:a.icePwd}),
e.push({fingerprints:[{algorithm:a.fingerprint.type,value:a.fingerprint.hash}]}));if(a.rtp&&"video"!==a.type){var f=a.connection?a.connection.ip:null,g=a.direction,h=a.type,k=a.mid,l=a.port||null,m="rtcp-mux"===a.rtcpMux,n,p,q;(a.ssrcs||[]).forEach(function(a){switch(a.attribute){case "cname":p=a.id;n=a.value;break;case "label":case "mslabel":p=a.id;break;case "msid":p=a.id,q=a.value.split(" ")[0]}});var t={type:h,muxId:k,codecs:a.rtp.map(function(a){var b={name:a.codec,payloadType:parseInt(a.payload),
clockRate:parseInt(a.rate),numChannels:a.encoding||1,rtcpFeedback:[],parameters:{}};switch(a.codec){case "telephone-event":b.parameters.events="0-16"}return b}),headerExtensions:[],encodings:a.rtp.map(function(a){return{ssrc:p,codecPayloadType:parseInt(a.payload),active:!0}}),rtcp:{ssrc:p,cname:n,mux:m}},r=new w(f,c,t,g,h,k,l,m,q);(a.candidates||[]).forEach(function(a){a={foundation:String(a.foundation),protocol:a.transport,priority:a.priority,ip:a.ip,port:a.port,type:a.type,relatedAddress:a.raddr,
relatedPort:a.rport};c.push(a);r.addCandidate(a)});void 0;"end-of-candidates"===a.endOfCandidates&&r.addCandidate({});b.push(r)}});return{iceParameters:d,dtlsParameters:e,mediaSections:b}}},{"./mediasection":27,"sdp-transform":35}],34:[function(l,n,k){var a=n.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:"username sessionId sessionVersion netType ipVer address".split(" "),format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],
u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,
names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,
names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],
format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},
{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:"foundation component transport priority ip port type raddr rport tcptype generation network-id network-cost".split(" "),format:function(a){var g;
g="candidate:%s %d %s %d %s %d typ %s"+(null!=a.raddr?" raddr %s rport %d":"%v%v");g+=null!=a.tcptype?" tcptype %s":"%v";null!=a.generation&&(g+=" generation %d");g+=null!=a["network-id"]?" network-id %d":"%v";return g+=null!=a["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,
names:["id","attribute","value"],format:function(a){var g="ssrc:%d";null!=a.attribute&&(g+=" %s",null!=a.value&&(g+=":%s"));return g}},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},
{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return null!=a.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(a).forEach(function(g){a[g].forEach(function(a){a.reg||(a.reg=/(.*)/);a.format||(a.format="%s")})})},{}],35:[function(l,n,k){n=l("./parser");l=l("./writer");k.write=l;k.parse=n.parse;k.parseFmtpConfig=n.parseFmtpConfig;k.parsePayloads=n.parsePayloads;k.parseRemoteCandidates=
n.parseRemoteCandidates},{"./parser":36,"./writer":37}],36:[function(l,n,k){var a=function(a){return String(Number(a))===a?Number(a):a},g=l("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);k.parse=function(d){var f={},k=[],l=f;d.split(/(\r\n|\r|\n)/).filter(h).forEach(function(d){var e=d[0],f=d.slice(2);"m"===e&&(k.push({rtp:[],fmtp:[]}),l=k[k.length-1]);for(d=0;d<(g[e]||[]).length;d+=1){var c=g[e][d];if(c.reg.test(f)){e=c;d=l;c=f;f=e.name&&e.names;e.push&&!d[e.push]?d[e.push]=[]:f&&!d[e.name]&&
(d[e.name]={});var f=e.push?{}:f?d[e.name]:d,c=c.match(e.reg),b=f,h=e.names,m=e.name;if(m&&!h)b[m]=a(c[1]);else for(m=0;m<h.length;m+=1)null!=c[m+1]&&(b[h[m]]=a(c[m+1]));e.push&&d[e.push].push(f);break}}});f.media=k;return f};var m=function(d,f){var g=f.split(/=(.+)/,2);2===g.length&&(d[g[0]]=a(g[1]));return d};k.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(m,{})};k.parsePayloads=function(a){return a.split(" ").map(Number)};k.parseRemoteCandidates=function(d){var f=[];d=d.split(" ").map(a);
for(var g=0;g<d.length;g+=3)f.push({component:d[g],ip:d[g+1],port:d[g+2]});return f}},{"./grammar":34}],37:[function(l,n,k){var a=l("./grammar"),g=/%[sdv%]/g,h=function(a){var d=1,e=arguments,f=e.length;return a.replace(g,function(a){if(d>=f)return a;var c=e[d];d+=1;switch(a){case "%%":return"%";case "%s":return String(c);case "%d":return Number(c);case "%v":return""}})},m=function(a,d,e){var f=d.format instanceof Function?d.format(d.push?e:e[d.name]):d.format;a=[a+"="+f];if(d.names)for(f=0;f<d.names.length;f+=
1){var g=d.names[f];d.name?a.push(e[d.name][g]):a.push(e[d.names[f]])}else a.push(e[d.name]);return h.apply(null,a)},d="vosiuepcbtrza".split(""),f=["i","c","b","a"];n.exports=function(g,h){h=h||{};null==g.version&&(g.version=0);null==g.name&&(g.name=" ");g.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var e=h.innerOrder||f,k=[];(h.outerOrder||d).forEach(function(d){a[d].forEach(function(a){a.name in g&&null!=g[a.name]?k.push(m(d,a,g)):a.push in g&&null!=g[a.push]&&g[a.push].forEach(function(b){k.push(m(d,
a,b))})})});g.media.forEach(function(d){k.push(m("m",a.m[0],d));e.forEach(function(c){a[c].forEach(function(a){a.name in d&&null!=d[a.name]?k.push(m(c,a,d)):a.push in d&&null!=d[a.push]&&d[a.push].forEach(function(b){k.push(m(c,a,b))})})})});return k.join("\r\n")+"\r\n"}},{"./grammar":34}],38:[function(l,n,k){n.exports="function"===typeof Object.create?function(a,g){a.super_=g;a.prototype=Object.create(g.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,g){a.super_=
g;var h=function(){};h.prototype=g.prototype;a.prototype=new h;a.prototype.constructor=a}},{}],39:[function(l,n,k){n.exports=function(a){return a&&"object"===typeof a&&"function"===typeof a.copy&&"function"===typeof a.fill&&"function"===typeof a.readUInt8}},{}],40:[function(l,n,k){function a(a,b){var e={seen:[],stylize:h};3<=arguments.length&&(e.depth=arguments[2]);4<=arguments.length&&(e.colors=arguments[3]);c(b)?e.showHidden=b:b&&k._extend(e,b);p(e.showHidden)&&(e.showHidden=!1);p(e.depth)&&(e.depth=
2);p(e.colors)&&(e.colors=!1);p(e.customInspect)&&(e.customInspect=!0);e.colors&&(e.stylize=g);return d(e,a,e.depth)}function g(b,c){var d=a.styles[c];return d?"\u001b["+a.colors[d][0]+"m"+b+"\u001b["+a.colors[d][1]+"m":b}function h(a,b){return a}function m(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function d(a,b,c){if(a.customInspect&&b&&u(b.inspect)&&b.inspect!==k.inspect&&(!b.constructor||b.constructor.prototype!==b)){var g=b.inspect(c,a);r(g)||(g=d(a,g,c));return g}if(g=f(a,b))return g;
var h=Object.keys(b),l=m(h);a.showHidden&&(h=Object.getOwnPropertyNames(b));if(H(b)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return w(b);if(0===h.length){if(u(b))return a.stylize("[Function"+(b.name?": "+b.name:"")+"]","special");if(y(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(B(b))return a.stylize(Date.prototype.toString.call(b),"date");if(H(b))return w(b)}var g="",n=!1,p=["{","}"];q(b)&&(n=!0,p=["[","]"]);u(b)&&(g=" [Function"+(b.name?": "+b.name:"")+"]");
y(b)&&(g=" "+RegExp.prototype.toString.call(b));B(b)&&(g=" "+Date.prototype.toUTCString.call(b));H(b)&&(g=" "+w(b));if(0===h.length&&(!n||0==b.length))return p[0]+g+p[1];if(0>c)return y(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);h=n?v(a,b,c,l,h):h.map(function(d){return e(a,b,c,l,d,n)});a.seen.pop();return t(h,g,p)}function f(a,d){if(p(d))return a.stylize("undefined","undefined");if(r(d)){var e="'"+JSON.stringify(d).replace(/^"|"$/g,"").replace(/'/g,
"\\'").replace(/\\"/g,'"')+"'";return a.stylize(e,"string")}if(b(d))return a.stylize(""+d,"number");if(c(d))return a.stylize(""+d,"boolean");if(null===d)return a.stylize("null","null")}function w(a){return"["+Error.prototype.toString.call(a)+"]"}function v(a,b,c,d,f){for(var g=[],h=0,k=b.length;h<k;++h)Object.prototype.hasOwnProperty.call(b,String(h))?g.push(e(a,b,c,d,String(h),!0)):g.push("");f.forEach(function(f){f.match(/^\d+$/)||g.push(e(a,b,c,d,f,!0))});return g}function e(a,b,c,e,f,g){var h,
k;b=Object.getOwnPropertyDescriptor(b,f)||{value:b[f]};b.get?k=b.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.set&&(k=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(h="["+f+"]");k||(0>a.seen.indexOf(b.value)?(k=null===c?d(a,b.value,null):d(a,b.value,c-1),-1<k.indexOf("\n")&&(k=g?k.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+k.split("\n").map(function(a){return"   "+a}).join("\n"))):k=a.stylize("[Circular]","special"));
if(p(h)){if(g&&f.match(/^\d+$/))return k;h=JSON.stringify(""+f);h.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(h=h.substr(1,h.length-2),h=a.stylize(h,"name")):(h=h.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),h=a.stylize(h,"string"))}return h+": "+k}function t(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function q(a){return Array.isArray(a)}
function c(a){return"boolean"===typeof a}function b(a){return"number"===typeof a}function r(a){return"string"===typeof a}function p(a){return void 0===a}function y(a){return C(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function C(a){return"object"===typeof a&&null!==a}function B(a){return C(a)&&"[object Date]"===Object.prototype.toString.call(a)}function H(a){return C(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function u(a){return"function"===typeof a}
function G(a){return 10>a?"0"+a.toString(10):a.toString(10)}function D(){var a=new Date,b=[G(a.getHours()),G(a.getMinutes()),G(a.getSeconds())].join(":");return[a.getDate(),x[a.getMonth()],b].join(" ")}var A=/%[sdj%]/g;k.format=function(b){if(!r(b)){for(var c=[],d=0;d<arguments.length;d++)c.push(a(arguments[d]));return c.join(" ")}for(var d=1,e=arguments,f=e.length,c=String(b).replace(A,function(a){if("%%"===a)return"%";if(d>=f)return a;switch(a){case "%s":return String(e[d++]);case "%d":return Number(e[d++]);
case "%j":try{return JSON.stringify(e[d++])}catch(K){return"[Circular]"}default:return a}}),g=e[d];d<f;g=e[++d])c=null!==g&&C(g)?c+(" "+a(g)):c+(" "+g);return c};k.deprecate=function(a,b){if(p(global.process))return function(){return k.deprecate(a,b).apply(this,arguments)};if(!0===process.noDeprecation)return a;var c=!1;return function(){if(!c){if(process.throwDeprecation)throw Error(b);process.traceDeprecation?console.trace(b):console.error(b);c=!0}return a.apply(this,arguments)}};var z={},E;k.debuglog=
function(a){p(E)&&(E=process.env.NODE_DEBUG||"");a=a.toUpperCase();if(!z[a])if((new RegExp("\\b"+a+"\\b","i")).test(E)){var b=process.pid;z[a]=function(){var c=k.format.apply(k,arguments);console.error("%s %d: %s",a,b,c)}}else z[a]=function(){};return z[a]};k.inspect=a;a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow",
"boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};k.isArray=q;k.isBoolean=c;k.isNull=function(a){return null===a};k.isNullOrUndefined=function(a){return null==a};k.isNumber=b;k.isString=r;k.isSymbol=function(a){return"symbol"===typeof a};k.isUndefined=p;k.isRegExp=y;k.isObject=C;k.isDate=B;k.isError=H;k.isFunction=u;k.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===
typeof a};k.isBuffer=l("./support/isBuffer");var x="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");k.log=function(){console.log("%s - %s",D(),k.format.apply(k,arguments))};k.inherits=l("inherits");k._extend=function(a,b){if(!b||!C(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}},{"./support/isBuffer":39,inherits:38}],41:[function(l,n,k){function a(a,k,d){return k?new g(a,k):new g(a)}l=function(){return this}();var g=l.WebSocket||l.MozWebSocket;n.exports=
g?a:null;g&&(a.prototype=g.prototype)},{}],42:[function(l,n,k){k.XMLHttpRequest=XMLHttpRequest},{}]},{},[1]);
